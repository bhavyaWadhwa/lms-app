{"ast":null,"code":"// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar List = require(\"bs-platform/lib/js/list.js\");\n\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\n\nvar Fetch = require(\"bs-fetch/src/Fetch.js\");\n\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\n\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\n\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\n\nvar Json_decode = require(\"@glennsl/bs-json/src/Json_decode.bs.js\");\n\nvar $$Notification = require(\"../Notification.bs.js\");\n\nvar Caml_exceptions = require(\"bs-platform/lib/js/caml_exceptions.js\");\n\nvar AuthenticityToken = require(\"./AuthenticityToken.bs.js\");\n\nvar Graphql_error = Caml_exceptions.create(\"GraphqlQuery.Graphql_error\");\n\nfunction decodeNotification(json) {\n  return {\n    kind: Json_decode.field(\"kind\", Json_decode.string, json),\n    title: Json_decode.field(\"title\", Json_decode.string, json),\n    body: Json_decode.field(\"body\", Json_decode.string, json)\n  };\n}\n\nfunction flashNotifications(obj) {\n  var match = Js_dict.get(obj, \"notifications\");\n\n  if (match !== undefined) {\n    return List.iter(function (n) {\n      var match = n.kind;\n      var notify;\n\n      switch (match) {\n        case \"error\":\n          notify = $$Notification.error;\n          break;\n\n        case \"success\":\n          notify = $$Notification.success;\n          break;\n\n        default:\n          notify = $$Notification.notice;\n      }\n\n      return Curry._2(notify, n.title, n.body);\n    }, Json_decode.list(decodeNotification, Caml_option.valFromOption(match)));\n  } else {\n    return (\n      /* () */\n      0\n    );\n  }\n}\n\nfunction sendQuery(notifyOpt, q) {\n  var notify = notifyOpt !== undefined ? notifyOpt : true;\n  return fetch(\"/graphql\", Fetch.RequestInit.make(\n  /* Post */\n  2, [\n  /* tuple */\n  [\"X-CSRF-Token\", AuthenticityToken.fromHead(\n  /* () */\n  0)],\n  /* tuple */\n  [\"Content-Type\", \"application/json\"]], Caml_option.some(JSON.stringify(Js_dict.fromList(\n  /* :: */\n  [\n  /* tuple */\n  [\"query\", q.query],\n  /* :: */\n  [\n  /* tuple */\n  [\"variables\", q.variables],\n  /* [] */\n  0]]))), undefined, undefined, undefined,\n  /* Include */\n  2, undefined, undefined, undefined, undefined, undefined)(\n  /* () */\n  0)).then(function (resp) {\n    if (resp.ok) {\n      return resp.json();\n    } else {\n      if (notify) {\n        var statusCode = String(resp.status);\n        $$Notification.error(\"Error \" + statusCode, \"Our team has been notified of this error. Please reload the page and try again.\");\n      }\n\n      return Promise.reject([Graphql_error, \"Request failed: \" + resp.statusText]);\n    }\n  }).then(function (json) {\n    var match = Js_json.decodeObject(json);\n\n    if (match !== undefined) {\n      var obj = Caml_option.valFromOption(match);\n\n      if (notify) {\n        flashNotifications(obj);\n      }\n\n      return Promise.resolve(Curry._1(q.parse, obj[\"data\"]));\n    } else {\n      return Promise.reject([Graphql_error, \"Response is not an object\"]);\n    }\n  });\n}\n\nexports.sendQuery = sendQuery;\n/* Notification Not a pure module */","map":{"version":3,"sources":["/home/kochar/Documents/pupilfirst-master/app/javascript/shared/utils/GraphqlQuery.bs.js"],"names":["List","require","Curry","Fetch","Js_dict","Js_json","Caml_option","Json_decode","$$Notification","Caml_exceptions","AuthenticityToken","Graphql_error","create","decodeNotification","json","kind","field","string","title","body","flashNotifications","obj","match","get","undefined","iter","n","notify","error","success","notice","_2","list","valFromOption","sendQuery","notifyOpt","q","fetch","RequestInit","make","fromHead","some","JSON","stringify","fromList","query","variables","then","resp","ok","statusCode","String","status","Promise","reject","statusText","decodeObject","resolve","_1","parse","exports"],"mappings":"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","sourcesContent":["// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar List = require(\"bs-platform/lib/js/list.js\");\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\nvar Fetch = require(\"bs-fetch/src/Fetch.js\");\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\nvar Json_decode = require(\"@glennsl/bs-json/src/Json_decode.bs.js\");\nvar $$Notification = require(\"../Notification.bs.js\");\nvar Caml_exceptions = require(\"bs-platform/lib/js/caml_exceptions.js\");\nvar AuthenticityToken = require(\"./AuthenticityToken.bs.js\");\n\nvar Graphql_error = Caml_exceptions.create(\"GraphqlQuery.Graphql_error\");\n\nfunction decodeNotification(json) {\n  return {\n          kind: Json_decode.field(\"kind\", Json_decode.string, json),\n          title: Json_decode.field(\"title\", Json_decode.string, json),\n          body: Json_decode.field(\"body\", Json_decode.string, json)\n        };\n}\n\nfunction flashNotifications(obj) {\n  var match = Js_dict.get(obj, \"notifications\");\n  if (match !== undefined) {\n    return List.iter((function (n) {\n                  var match = n.kind;\n                  var notify;\n                  switch (match) {\n                    case \"error\" :\n                        notify = $$Notification.error;\n                        break;\n                    case \"success\" :\n                        notify = $$Notification.success;\n                        break;\n                    default:\n                      notify = $$Notification.notice;\n                  }\n                  return Curry._2(notify, n.title, n.body);\n                }), Json_decode.list(decodeNotification, Caml_option.valFromOption(match)));\n  } else {\n    return /* () */0;\n  }\n}\n\nfunction sendQuery(notifyOpt, q) {\n  var notify = notifyOpt !== undefined ? notifyOpt : true;\n  return fetch(\"/graphql\", Fetch.RequestInit.make(/* Post */2, [\n                        /* tuple */[\n                          \"X-CSRF-Token\",\n                          AuthenticityToken.fromHead(/* () */0)\n                        ],\n                        /* tuple */[\n                          \"Content-Type\",\n                          \"application/json\"\n                        ]\n                      ], Caml_option.some(JSON.stringify(Js_dict.fromList(/* :: */[\n                                    /* tuple */[\n                                      \"query\",\n                                      q.query\n                                    ],\n                                    /* :: */[\n                                      /* tuple */[\n                                        \"variables\",\n                                        q.variables\n                                      ],\n                                      /* [] */0\n                                    ]\n                                  ]))), undefined, undefined, undefined, /* Include */2, undefined, undefined, undefined, undefined, undefined)(/* () */0)).then((function (resp) {\n                  if (resp.ok) {\n                    return resp.json();\n                  } else {\n                    if (notify) {\n                      var statusCode = String(resp.status);\n                      $$Notification.error(\"Error \" + statusCode, \"Our team has been notified of this error. Please reload the page and try again.\");\n                    }\n                    return Promise.reject([\n                                Graphql_error,\n                                \"Request failed: \" + resp.statusText\n                              ]);\n                  }\n                })).then((function (json) {\n                var match = Js_json.decodeObject(json);\n                if (match !== undefined) {\n                  var obj = Caml_option.valFromOption(match);\n                  if (notify) {\n                    flashNotifications(obj);\n                  }\n                  return Promise.resolve(Curry._1(q.parse, obj[\"data\"]));\n                } else {\n                  return Promise.reject([\n                              Graphql_error,\n                              \"Response is not an object\"\n                            ]);\n                }\n              }));\n}\n\nexports.sendQuery = sendQuery;\n/* Notification Not a pure module */\n"]},"metadata":{},"sourceType":"module"}