{"ast":null,"code":"// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar Icon = require(\"../../../shared/Icon.bs.js\");\n\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\n\nvar Block = require(\"bs-platform/lib/js/block.js\");\n\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\n\nvar React = require(\"react\");\n\nvar FaIcon = require(\"../../../shared/components/FaIcon.bs.js\");\n\nvar Js_exn = require(\"bs-platform/lib/js/js_exn.js\");\n\nvar $$String = require(\"bs-platform/lib/js/string.js\");\n\nvar DateFns = require(\"../../../shared/utils/DateFns.bs.js\");\n\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\n\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\n\nvar Caml_obj = require(\"bs-platform/lib/js/caml_obj.js\");\n\nvar DomUtils = require(\"../../../shared/utils/DomUtils.bs.js\");\n\nvar HelpIcon = require(\"../../../shared/components/HelpIcon.bs.js\");\n\nvar Js_option = require(\"bs-platform/lib/js/js_option.js\");\n\nvar ArrayUtils = require(\"../../../shared/utils/ArrayUtils.bs.js\");\n\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\n\nvar GradeLabel = require(\"../../../shared/types/GradeLabel.bs.js\");\n\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\n\nvar OptionUtils = require(\"../../../shared/utils/OptionUtils.bs.js\");\n\nvar GraphqlQuery = require(\"../../../shared/utils/GraphqlQuery.bs.js\");\n\nvar DisablingCover = require(\"../../../shared/components/DisablingCover.bs.js\");\n\nvar MarkdownEditor = require(\"../../../shared/components/MarkdownEditor.bs.js\");\n\nvar EvaluationCriterion = require(\"../../../shared/types/EvaluationCriterion.bs.js\");\n\nvar CoursesReview__Grade = require(\"../types/CoursesReview__Grade.bs.js\");\n\nvar SubmissionChecklistItem = require(\"../types/SubmissionChecklistItem.bs.js\");\n\nvar SubmissionChecklistShow = require(\"./SubmissionChecklistShow.bs.js\");\n\nvar CoursesReview__FeedbackEditor = require(\"./CoursesReview__FeedbackEditor.bs.js\");\n\nvar CoursesReview__OverlaySubmission = require(\"../types/CoursesReview__OverlaySubmission.bs.js\");\n\nrequire(\"./CoursesReview__GradeCard.css\");\n\nfunction str(prim) {\n  return prim;\n}\n\nfunction reducer(state, action) {\n  if (typeof action === \"number\") {\n    if (action ===\n    /* BeginSaving */\n    0) {\n      return {\n        grades: state.grades,\n        newFeedback: state.newFeedback,\n        saving: true,\n        checklist: state.checklist,\n        note: state.note\n      };\n    } else {\n      return {\n        grades: state.grades,\n        newFeedback: state.newFeedback,\n        saving: false,\n        checklist: state.checklist,\n        note: state.note\n      };\n    }\n  } else {\n    switch (action.tag | 0) {\n      case\n      /* UpdateFeedback */\n      0:\n        return {\n          grades: state.grades,\n          newFeedback: action[0],\n          saving: state.saving,\n          checklist: state.checklist,\n          note: state.note\n        };\n\n      case\n      /* UpdateGrades */\n      1:\n        return {\n          grades: action[0],\n          newFeedback: state.newFeedback,\n          saving: state.saving,\n          checklist: state.checklist,\n          note: state.note\n        };\n\n      case\n      /* UpdateChecklist */\n      2:\n        return {\n          grades: state.grades,\n          newFeedback: state.newFeedback,\n          saving: state.saving,\n          checklist: action[0],\n          note: state.note\n        };\n\n      case\n      /* UpdateNote */\n      3:\n        return {\n          grades: state.grades,\n          newFeedback: state.newFeedback,\n          saving: state.saving,\n          checklist: state.checklist,\n          note: action[0]\n        };\n    }\n  }\n}\n\nfunction passed(grades, evaluationCriteria) {\n  return ArrayUtils.isEmpty(grades.filter(function (g) {\n    var passGrade = EvaluationCriterion.passGrade(ArrayUtils.unsafeFind(function (ec) {\n      return EvaluationCriterion.id(ec) === CoursesReview__Grade.evaluationCriterionId(g);\n    }, \"CoursesReview__GradeCard: Unable to find evaluation criterion with id - \" + CoursesReview__Grade.evaluationCriterionId(g), evaluationCriteria));\n    return CoursesReview__Grade.value(g) < passGrade;\n  }));\n}\n\nvar ppx_printed_query = \"mutation CreateGradingMutation($submissionId: ID!, $feedback: String, $grades: [GradeInput!]!, $note: String, $checklist: JSON!)  {\\ncreateGrading(submissionId: $submissionId, feedback: $feedback, grades: $grades, note: $note, checklist: $checklist)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"createGrading\");\n  var tmp;\n\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type CreateGradingPayload is missing\");\n    }\n\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field createGrading on type Mutation is missing\");\n  }\n\n  return {\n    createGrading: tmp\n  };\n}\n\nfunction json_of_GradeInput(value) {\n  return Js_dict.fromArray([\n  /* tuple */\n  [\"evaluationCriterionId\", value.evaluationCriterionId],\n  /* tuple */\n  [\"grade\", value.grade]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  }));\n}\n\nfunction make(submissionId, feedback, grades, note, checklist, param) {\n  return {\n    query: ppx_printed_query,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"submissionId\", submissionId],\n    /* tuple */\n    [\"feedback\", feedback !== undefined ? feedback : null],\n    /* tuple */\n    [\"grades\", grades.map(json_of_GradeInput)],\n    /* tuple */\n    [\"note\", note !== undefined ? note : null],\n    /* tuple */\n    [\"checklist\", checklist]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse\n  };\n}\n\nfunction makeWithVariables(variables) {\n  var submissionId = variables.submissionId;\n  var feedback = variables.feedback;\n  var grades = variables.grades;\n  var note = variables.note;\n  var checklist = variables.checklist;\n  return {\n    query: ppx_printed_query,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"submissionId\", submissionId],\n    /* tuple */\n    [\"feedback\", feedback !== undefined ? feedback : null],\n    /* tuple */\n    [\"grades\", grades.map(json_of_GradeInput)],\n    /* tuple */\n    [\"note\", note !== undefined ? note : null],\n    /* tuple */\n    [\"checklist\", checklist]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse\n  };\n}\n\nfunction makeVariables(submissionId, feedback, grades, note, checklist, param) {\n  return Js_dict.fromArray([\n  /* tuple */\n  [\"submissionId\", submissionId],\n  /* tuple */\n  [\"feedback\", feedback !== undefined ? feedback : null],\n  /* tuple */\n  [\"grades\", grades.map(json_of_GradeInput)],\n  /* tuple */\n  [\"note\", note !== undefined ? note : null],\n  /* tuple */\n  [\"checklist\", checklist]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  }));\n}\n\nfunction definition_002(graphql_ppx_use_json_variables_fn, submissionId, feedback, grades, note, checklist, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([\n  /* tuple */\n  [\"submissionId\", submissionId],\n  /* tuple */\n  [\"feedback\", feedback !== undefined ? feedback : null],\n  /* tuple */\n  [\"grades\", grades.map(json_of_GradeInput)],\n  /* tuple */\n  [\"note\", note !== undefined ? note : null],\n  /* tuple */\n  [\"checklist\", checklist]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  })));\n}\n\nvar definition =\n/* tuple */\n[parse, ppx_printed_query, definition_002];\n\nfunction ret_type(f) {\n  return {};\n}\n\nvar MT_Ret = {};\nvar CreateGradingMutation = {\n  ppx_printed_query: ppx_printed_query,\n  query: ppx_printed_query,\n  parse: parse,\n  json_of_GradeInput: json_of_GradeInput,\n  make: make,\n  makeWithVariables: makeWithVariables,\n  makeVariables: makeVariables,\n  definition: definition,\n  ret_type: ret_type,\n  MT_Ret: MT_Ret\n};\nvar ppx_printed_query$1 = \"mutation UndoGradingMutation($submissionId: ID!)  {\\nundoGrading(submissionId: $submissionId)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse$1(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"undoGrading\");\n  var tmp;\n\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type UndoGradingPayload is missing\");\n    }\n\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field undoGrading on type Mutation is missing\");\n  }\n\n  return {\n    undoGrading: tmp\n  };\n}\n\nfunction make$1(submissionId, param) {\n  return {\n    query: ppx_printed_query$1,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"submissionId\", submissionId]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse$1\n  };\n}\n\nfunction makeWithVariables$1(variables) {\n  var submissionId = variables.submissionId;\n  return {\n    query: ppx_printed_query$1,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"submissionId\", submissionId]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse$1\n  };\n}\n\nfunction makeVariables$1(submissionId, param) {\n  return Js_dict.fromArray([\n  /* tuple */\n  [\"submissionId\", submissionId]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  }));\n}\n\nfunction definition_002$1(graphql_ppx_use_json_variables_fn, submissionId, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([\n  /* tuple */\n  [\"submissionId\", submissionId]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  })));\n}\n\nvar definition$1 =\n/* tuple */\n[parse$1, ppx_printed_query$1, definition_002$1];\n\nfunction ret_type$1(f) {\n  return {};\n}\n\nvar MT_Ret$1 = {};\nvar UndoGradingMutation = {\n  ppx_printed_query: ppx_printed_query$1,\n  query: ppx_printed_query$1,\n  parse: parse$1,\n  make: make$1,\n  makeWithVariables: makeWithVariables$1,\n  makeVariables: makeVariables$1,\n  definition: definition$1,\n  ret_type: ret_type$1,\n  MT_Ret: MT_Ret$1\n};\n\nfunction undoGrading(submissionId, send) {\n  Curry._1(send,\n  /* BeginSaving */\n  0);\n\n  (function (eta) {\n    return GraphqlQuery.sendQuery(undefined, eta);\n  })(make$1(submissionId,\n  /* () */\n  0)).then(function (response) {\n    if (response.undoGrading.success) {\n      DomUtils.reload(\n      /* () */\n      0);\n    } else {\n      Curry._1(send,\n      /* FinishSaving */\n      1);\n    }\n\n    return Promise.resolve(\n    /* () */\n    0);\n  });\n  return (\n    /* () */\n    0\n  );\n}\n\nfunction trimToOption(s) {\n  var s$1 = $$String.trim(s);\n\n  if (s$1 === \"\") {\n    return;\n  } else {\n    return s$1;\n  }\n}\n\nfunction gradeSubmissionQuery(submissionId, state, send, evaluationCriteria, addGradingCB) {\n  var jsGradesArray = $$Array.map(CoursesReview__Grade.asJsType, state.grades);\n  var checklist = SubmissionChecklistItem.encodeArray(state.checklist);\n\n  Curry._1(send,\n  /* BeginSaving */\n  0);\n\n  var feedback = trimToOption(state.newFeedback);\n  var note = OptionUtils.flatMap(trimToOption, state.note);\n  (function (eta) {\n    return GraphqlQuery.sendQuery(undefined, eta);\n  })(make(submissionId, feedback, jsGradesArray, note, checklist,\n  /* () */\n  0)).then(function (response) {\n    if (response.createGrading.success) {\n      Curry._4(addGradingCB, state.newFeedback, passed(state.grades, evaluationCriteria), state.grades, state.checklist);\n    }\n\n    Curry._1(send,\n    /* FinishSaving */\n    1);\n\n    return Promise.resolve(\n    /* () */\n    0);\n  });\n  return (\n    /* () */\n    0\n  );\n}\n\nfunction updateGrading(grade, state, send) {\n  var newGrades = $$Array.append([grade], state.grades.filter(function (g) {\n    return CoursesReview__Grade.evaluationCriterionId(g) !== CoursesReview__Grade.evaluationCriterionId(grade);\n  }));\n  return Curry._1(send,\n  /* UpdateGrades */\n  Block.__(1, [newGrades]));\n}\n\nfunction handleGradePillClick(evaluationCriterionId, value, state, send, $$event) {\n  $$event.preventDefault();\n\n  if (send !== undefined) {\n    return updateGrading(CoursesReview__Grade.make(evaluationCriterionId, value), state, send);\n  } else {\n    return (\n      /* () */\n      0\n    );\n  }\n}\n\nfunction findEvaluationCriterion(evaluationCriteria, evaluationCriterionId) {\n  var match = evaluationCriteria.find(function (ec) {\n    return EvaluationCriterion.id(ec) === evaluationCriterionId;\n  });\n\n  if (match !== undefined) {\n    return match;\n  } else {\n    Rollbar.error(\"Unable to find evaluation Criterion with id: \" + (evaluationCriterionId + \"in CoursesRevew__GradeCard\"));\n    return Caml_array.caml_array_get(evaluationCriteria, 0);\n  }\n}\n\nfunction gradePillHeader(evaluationCriteriaName, selectedGrade, gradeLabels) {\n  return React.createElement(\"div\", {\n    className: \"flex justify-between\"\n  }, React.createElement(\"p\", {\n    className: \"text-xs font-semibold\"\n  }, evaluationCriteriaName), React.createElement(\"p\", {\n    className: \"text-xs font-semibold\"\n  }, String(selectedGrade) + (\"/\" + String(GradeLabel.maxGrade($$Array.to_list(gradeLabels))))));\n}\n\nfunction gradePillClasses(selectedGrade, currentGrade, passgrade, send) {\n  var defaultClasses = \"course-review-grade-card__grade-pill border-gray-400 py-1 px-2 text-sm flex-1 font-semibold \" + (send !== undefined ? \"cursor-pointer hover:shadow-lg focus:outline-none \" + (Caml_obj.caml_greaterequal(currentGrade, passgrade) ? \"hover:bg-green-500 hover:text-white \" : \"hover:bg-red-500 hover:text-white \") : \"\");\n  return defaultClasses + (Caml_obj.caml_lessequal(currentGrade, selectedGrade) ? Caml_obj.caml_greaterequal(selectedGrade, passgrade) ? \"bg-green-500 text-white shadow-lg\" : \"bg-red-500 text-white shadow-lg\" : \"bg-white text-gray-900\");\n}\n\nfunction showGradePill(key, evaluationCriterion, gradeValue, passGrade, state, send) {\n  return React.createElement(\"div\", {\n    key: String(key),\n    \"aria-label\": \"evaluation-criterion-\" + EvaluationCriterion.id(evaluationCriterion),\n    className: \"md:pr-8 mt-4\"\n  }, gradePillHeader(EvaluationCriterion.name(evaluationCriterion), gradeValue, EvaluationCriterion.gradesAndLabels(evaluationCriterion)), React.createElement(\"div\", {\n    className: \"course-review-grade-card__grade-bar inline-flex w-full text-center mt-1\"\n  }, $$Array.map(function (gradeLabel) {\n    var gradeLabelGrade = GradeLabel.grade(gradeLabel);\n    var partial_arg = EvaluationCriterion.id(evaluationCriterion);\n    return React.createElement(\"div\", {\n      key: String(gradeLabelGrade),\n      className: gradePillClasses(gradeValue, gradeLabelGrade, passGrade, send),\n      title: GradeLabel.label(gradeLabel),\n      onClick: function onClick(param) {\n        return handleGradePillClick(partial_arg, gradeLabelGrade, state, send, param);\n      }\n    }, send !== undefined ? String(gradeLabelGrade) : null);\n  }, EvaluationCriterion.gradesAndLabels(evaluationCriterion))));\n}\n\nfunction showGrades(grades, evaluationCriteria, state) {\n  return React.createElement(\"div\", undefined, $$Array.mapi(function (key, grade) {\n    var gradeEcId = CoursesReview__Grade.evaluationCriterionId(grade);\n    var ec = ArrayUtils.unsafeFind(function (ec) {\n      return EvaluationCriterion.id(ec) === gradeEcId;\n    }, \"Unable to find evaluation Criterion with id: \" + (gradeEcId + \"in CoursesRevew__GradeCard\"), evaluationCriteria);\n    return showGradePill(key, ec, CoursesReview__Grade.value(grade), EvaluationCriterion.passGrade(ec), state, undefined);\n  }, CoursesReview__Grade.sort(evaluationCriteria, grades)));\n}\n\nfunction renderGradePills(evaluationCriteria, targetEvaluationCriteriaIds, state, send) {\n  return $$Array.mapi(function (key, evaluationCriterionId) {\n    var ec = ArrayUtils.unsafeFind(function (e) {\n      return EvaluationCriterion.id(e) === evaluationCriterionId;\n    }, \"CoursesReview__GradeCard: Unable to find evaluation criterion with id - \" + evaluationCriterionId, evaluationCriteria);\n    var grade = state.grades.find(function (g) {\n      return CoursesReview__Grade.evaluationCriterionId(g) === EvaluationCriterion.id(ec);\n    });\n    var gradeValue = grade !== undefined ? CoursesReview__Grade.value(grade) : 0;\n    var passGrade = EvaluationCriterion.passGrade(ec);\n    return showGradePill(key, ec, gradeValue, passGrade, state, send);\n  }, targetEvaluationCriteriaIds);\n}\n\nfunction gradeStatusClasses(color, status) {\n  return \"w-12 h-10 p-1 mr-2 md:mr-0 md:w-24 md:h-20 rounded md:rounded-lg border flex justify-center items-center bg-\" + (color + (\"-100 border-\" + (color + (\"-400 \" + (typeof status === \"number\" && status === 0 ? \"course-review-grade-card__status-pulse\" : \"\")))));\n}\n\nfunction submissionStatusIcon(status, overlaySubmission, send) {\n  var match = typeof status === \"number\" ? status !== 0 ?\n  /* tuple */\n  [\"Not Reviewed\", \"gray\"] :\n  /* tuple */\n  [\"Reviewing\", \"orange\"] : status[0] ?\n  /* tuple */\n  [\"Passed\", \"green\"] :\n  /* tuple */\n  [\"Failed\", \"red\"];\n  var color = match[1];\n  var match$1 = CoursesReview__OverlaySubmission.evaluatedAt(overlaySubmission);\n  var tmp;\n\n  if (match$1 !== undefined && typeof status !== \"number\") {\n    var match$2 = CoursesReview__OverlaySubmission.evaluatorName(overlaySubmission);\n    tmp = React.createElement(\"div\", {\n      className: \"bg-gray-200 block md:flex flex-col w-full justify-between rounded-lg pt-3 mr-2 mt-4 md:mt-0\"\n    }, React.createElement(\"div\", undefined, React.createElement(\"p\", {\n      className: \"text-xs px-3\"\n    }, \"Evaluated By\"), React.createElement(\"p\", {\n      className: \"text-sm font-semibold px-3 pb-3\"\n    }, match$2 !== undefined ? match$2 : React.createElement(\"em\", undefined, \"Deleted Coach\"))), React.createElement(\"div\", {\n      className: \"text-xs bg-gray-300 flex items-center rounded-b-lg px-3 py-2 md:px-3 md:py-1\"\n    }, \"on \" + DateFns.format(Caml_option.valFromOption(match$1), \"MMMM d, yyyy\")));\n  } else {\n    tmp = null;\n  }\n\n  var match$3 = CoursesReview__OverlaySubmission.evaluatedAt(overlaySubmission);\n  return React.createElement(\"div\", {\n    \"aria-label\": \"submission-status\",\n    className: \"flex w-full md:w-3/6 flex-col items-center justify-center md:border-l mt-4 md:mt-0\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col-reverse md:flex-row items-start md:items-stretch justify-center w-full md:pl-6\"\n  }, tmp, React.createElement(\"div\", {\n    className: \"w-full md:w-24 flex flex-row md:flex-col md:items-center justify-center\"\n  }, React.createElement(\"div\", {\n    className: gradeStatusClasses(color, status)\n  }, typeof status === \"number\" ? status !== 0 ? React.createElement(Icon.make, {\n    className: \"if i-eye-solid text-xl md:text-4xl text-gray-400\"\n  }) : React.createElement(Icon.make, {\n    className: \"if i-writing-pad-solid text-xl md:text-5xl text-orange-300\"\n  }) : status[0] ? React.createElement(Icon.make, {\n    className: \"if i-badge-check-solid text-xl md:text-5xl text-green-500\"\n  }) : React.createElement(FaIcon.make, {\n    classes: \"fas fa-exclamation-triangle text-xl md:text-4xl text-red-500\"\n  })), React.createElement(\"p\", {\n    className: \"text-xs flex items-center justify-center md:block text-center w-full border rounded px-1 py-px font-semibold md:mt-1 border-\" + (color + (\"-400 bg-\" + (color + (\"-100 text-\" + (color + \"-800 \")))))\n  }, match[0]))), match$3 !== undefined && typeof status !== \"number\" ? React.createElement(\"div\", {\n    className: \"mt-4 md:pl-6 w-full\"\n  }, React.createElement(\"button\", {\n    className: \"btn btn-danger btn-small\",\n    onClick: function onClick(param) {\n      return undoGrading(CoursesReview__OverlaySubmission.id(overlaySubmission), send);\n    }\n  }, React.createElement(\"i\", {\n    className: \"fas fa-undo\"\n  }), React.createElement(\"span\", {\n    className: \"ml-2\"\n  }, \"Undo Grading\"))) : null);\n}\n\nfunction gradeSubmission(submissionId, state, send, evaluationCriteria, addGradingCB, status, $$event) {\n  $$event.preventDefault();\n\n  if (typeof status === \"number\") {\n    return (\n      /* () */\n      0\n    );\n  } else {\n    return gradeSubmissionQuery(submissionId, state, send, evaluationCriteria, addGradingCB);\n  }\n}\n\nfunction showFeedbackForm(grades, reviewChecklist, updateReviewChecklistCB, state, send, targetId) {\n  if (grades.length !== 0) {\n    return null;\n  } else {\n    return React.createElement(CoursesReview__FeedbackEditor.make, {\n      feedback: state.newFeedback,\n      updateFeedbackCB: function updateFeedbackCB(feedback) {\n        return Curry._1(send,\n        /* UpdateFeedback */\n        Block.__(0, [feedback]));\n      },\n      label: \"Add Your Feedback\",\n      reviewChecklist: reviewChecklist,\n      updateReviewChecklistCB: updateReviewChecklistCB,\n      checklistVisible: true,\n      targetId: targetId\n    });\n  }\n}\n\nfunction reviewButtonDisabled(status) {\n  if (typeof status === \"number\") {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction computeStatus(overlaySubmission, selectedGrades, evaluationCriteria) {\n  var match = CoursesReview__OverlaySubmission.passedAt(overlaySubmission);\n  var match$1 = ArrayUtils.isNotEmpty(CoursesReview__OverlaySubmission.grades(overlaySubmission));\n\n  if (match !== undefined) {\n    return (\n      /* Graded */\n      [true]\n    );\n  } else if (match$1) {\n    return (\n      /* Graded */\n      [false]\n    );\n  } else if (Caml_obj.caml_equal(selectedGrades, [])) {\n    return (\n      /* Ungraded */\n      1\n    );\n  } else if (selectedGrades.length !== evaluationCriteria.length) {\n    return (\n      /* Grading */\n      0\n    );\n  } else {\n    return (\n      /* Graded */\n      [passed(selectedGrades, evaluationCriteria)]\n    );\n  }\n}\n\nfunction submitButtonText(feedback, grades) {\n  var match = feedback !== \"\";\n  ArrayUtils.isNotEmpty(grades);\n\n  if (match) {\n    return \"Save grades & send feedback\";\n  } else {\n    return \"Save grades\";\n  }\n}\n\nfunction noteForm(overlaySubmission, teamSubmission, note, send) {\n  var _someGrades = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n\n  if (_someGrades.length !== 0) {\n    return null;\n  } else {\n    var match = teamSubmission ?\n    /* tuple */\n    [\"team\", \" This submission is from a team, so a note added here will be posted to the report of all students in the team.\"] :\n    /* tuple */\n    [\"student\", \"\"];\n    var noteAbout = match[0];\n    var help = React.createElement(HelpIcon.make, {\n      className: \"ml-1\",\n      children: \"Notes can be used to keep track of a \" + (noteAbout + (\"'s progress. These notes are shown only to coaches in a student's report.\" + match[1]))\n    });\n    var textareaId = \"note-for-submission-\" + CoursesReview__OverlaySubmission.id(overlaySubmission);\n    return React.createElement(\"div\", {\n      className: \"text-sm\"\n    }, React.createElement(\"h5\", {\n      className: \"font-semibold text-sm flex items-center\"\n    }, React.createElement(\"i\", {\n      className: \"far fa-sticky-note text-gray-800 text-base\"\n    }), note !== undefined ? React.createElement(\"span\", {\n      className: \"ml-2 md:ml-3 tracking-wide\"\n    }, React.createElement(\"label\", {\n      htmlFor: textareaId\n    }, \"Write a Note\"), help) : React.createElement(\"div\", {\n      className: \"ml-2 md:ml-3 tracking-wide flex justify-between items-center w-full\"\n    }, React.createElement(\"span\", undefined, React.createElement(\"span\", undefined, \"Would you like to write a note about this \" + (noteAbout + \"?\")), help), React.createElement(\"button\", {\n      className: \"btn btn-small btn-primary-ghost ml-1\",\n      onClick: function onClick(param) {\n        return Curry._1(send,\n        /* UpdateNote */\n        Block.__(3, [\"\"]));\n      }\n    }, \"Write a Note\"))), note !== undefined ? React.createElement(\"div\", {\n      className: \"ml-6 md:ml-7 mt-2\"\n    }, React.createElement(MarkdownEditor.make, {\n      value: note,\n      onChange: function onChange(value) {\n        return Curry._1(send,\n        /* UpdateNote */\n        Block.__(3, [value]));\n      },\n      profile:\n      /* Permissive */\n      2,\n      textareaId: textareaId,\n      maxLength: 10000,\n      placeholder: \"Did you notice something while reviewing this submission?\"\n    })) : null);\n  }\n}\n\nfunction CoursesReview__GradeCard(Props) {\n  var overlaySubmission = Props.overlaySubmission;\n  var teamSubmission = Props.teamSubmission;\n  var evaluationCriteria = Props.evaluationCriteria;\n  var reviewChecklist = Props.reviewChecklist;\n  var addGradingCB = Props.addGradingCB;\n  var updateReviewChecklistCB = Props.updateReviewChecklistCB;\n  var targetId = Props.targetId;\n  var targetEvaluationCriteriaIds = Props.targetEvaluationCriteriaIds;\n  var match = React.useReducer(reducer, {\n    grades: [],\n    newFeedback: \"\",\n    saving: false,\n    checklist: CoursesReview__OverlaySubmission.checklist(overlaySubmission),\n    note: undefined\n  });\n  var send = match[1];\n  var state = match[0];\n  var status = computeStatus(overlaySubmission, state.grades, evaluationCriteria);\n  var match$1 = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var updateChecklistCB = match$1.length !== 0 ? undefined : function (checklist) {\n    return Curry._1(send,\n    /* UpdateChecklist */\n    Block.__(2, [checklist]));\n  };\n  var pending = ArrayUtils.isEmpty(CoursesReview__OverlaySubmission.grades(overlaySubmission));\n  var grades = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var match$2 = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var tmp;\n\n  if (match$2.length !== 0) {\n    tmp = null;\n  } else {\n    var partial_arg = CoursesReview__OverlaySubmission.id(overlaySubmission);\n    tmp = React.createElement(\"div\", {\n      className: \"bg-white pt-4 mr-4 ml-4 md:mr-6 md:ml-13\"\n    }, React.createElement(\"button\", {\n      className: \"btn btn-success btn-large w-full border border-green-600\",\n      disabled: reviewButtonDisabled(status),\n      onClick: function onClick(param) {\n        return gradeSubmission(partial_arg, state, send, evaluationCriteria, addGradingCB, status, param);\n      }\n    }, submitButtonText(state.newFeedback, state.grades)));\n  }\n\n  return React.createElement(DisablingCover.make, {\n    disabled: state.saving,\n    children: null\n  }, React.createElement(\"div\", undefined, React.createElement(\"div\", {\n    className: \"pt-2 pb-6 px-4 md:px-6 bg-gray-100 border-b\"\n  }, React.createElement(SubmissionChecklistShow.make, {\n    checklist: state.checklist,\n    updateChecklistCB: updateChecklistCB,\n    pending: pending\n  })), showFeedbackForm(CoursesReview__OverlaySubmission.grades(overlaySubmission), reviewChecklist, updateReviewChecklistCB, state, send, targetId), React.createElement(\"div\", {\n    className: \"w-full px-4 pt-4 md:px-6 md:pt-6\"\n  }, noteForm(overlaySubmission, teamSubmission, state.note, send), React.createElement(\"h5\", {\n    className: \"font-semibold text-sm flex items-center mt-4 md:mt-6\"\n  }, React.createElement(Icon.make, {\n    className: \"if i-tachometer-regular text-gray-800 text-base\"\n  }), React.createElement(\"span\", {\n    className: \"ml-2 md:ml-3 tracking-wide\"\n  }, \"Grade Card\")), React.createElement(\"div\", {\n    className: \"flex md:flex-row flex-col border md:ml-7 bg-gray-100 p-2 md:p-4 rounded-lg mt-2\"\n  }, React.createElement(\"div\", {\n    className: \"w-full md:w-3/6\"\n  }, grades.length !== 0 ? showGrades(grades, evaluationCriteria, state) : renderGradePills(evaluationCriteria, targetEvaluationCriteriaIds, state, send)), submissionStatusIcon(status, overlaySubmission, send)))), tmp);\n}\n\nvar make$2 = CoursesReview__GradeCard;\nexports.str = str;\nexports.reducer = reducer;\nexports.passed = passed;\nexports.CreateGradingMutation = CreateGradingMutation;\nexports.UndoGradingMutation = UndoGradingMutation;\nexports.undoGrading = undoGrading;\nexports.trimToOption = trimToOption;\nexports.gradeSubmissionQuery = gradeSubmissionQuery;\nexports.updateGrading = updateGrading;\nexports.handleGradePillClick = handleGradePillClick;\nexports.findEvaluationCriterion = findEvaluationCriterion;\nexports.gradePillHeader = gradePillHeader;\nexports.gradePillClasses = gradePillClasses;\nexports.showGradePill = showGradePill;\nexports.showGrades = showGrades;\nexports.renderGradePills = renderGradePills;\nexports.gradeStatusClasses = gradeStatusClasses;\nexports.submissionStatusIcon = submissionStatusIcon;\nexports.gradeSubmission = gradeSubmission;\nexports.showFeedbackForm = showFeedbackForm;\nexports.reviewButtonDisabled = reviewButtonDisabled;\nexports.computeStatus = computeStatus;\nexports.submitButtonText = submitButtonText;\nexports.noteForm = noteForm;\nexports.make = make$2;\n/*  Not a pure module */","map":{"version":3,"sources":["/home/kochar/Documents/pupilfirst-master/app/javascript/courses/review/components/CoursesReview__GradeCard.bs.js"],"names":["Icon","require","$$Array","Block","Curry","React","FaIcon","Js_exn","$$String","DateFns","Js_dict","Js_json","Caml_obj","DomUtils","HelpIcon","Js_option","ArrayUtils","Caml_array","GradeLabel","Caml_option","OptionUtils","GraphqlQuery","DisablingCover","MarkdownEditor","EvaluationCriterion","CoursesReview__Grade","SubmissionChecklistItem","SubmissionChecklistShow","CoursesReview__FeedbackEditor","CoursesReview__OverlaySubmission","str","prim","reducer","state","action","grades","newFeedback","saving","checklist","note","tag","passed","evaluationCriteria","isEmpty","filter","g","passGrade","unsafeFind","ec","id","evaluationCriterionId","value","ppx_printed_query","parse","value$1","getExn","decodeObject","match","get","tmp","undefined","value$2","valFromOption","match$1","tmp$1","value$3","match$2","decodeBoolean","raiseError","JSON","stringify","success","createGrading","json_of_GradeInput","fromArray","grade","param","test","make","submissionId","feedback","query","variables","map","makeWithVariables","makeVariables","definition_002","graphql_ppx_use_json_variables_fn","_1","definition","ret_type","f","MT_Ret","CreateGradingMutation","ppx_printed_query$1","parse$1","undoGrading","make$1","makeWithVariables$1","makeVariables$1","definition_002$1","definition$1","ret_type$1","MT_Ret$1","UndoGradingMutation","send","eta","sendQuery","then","response","reload","Promise","resolve","trimToOption","s","s$1","trim","gradeSubmissionQuery","addGradingCB","jsGradesArray","asJsType","encodeArray","flatMap","_4","updateGrading","newGrades","append","__","handleGradePillClick","$$event","preventDefault","findEvaluationCriterion","find","Rollbar","error","caml_array_get","gradePillHeader","evaluationCriteriaName","selectedGrade","gradeLabels","createElement","className","String","maxGrade","to_list","gradePillClasses","currentGrade","passgrade","defaultClasses","caml_greaterequal","caml_lessequal","showGradePill","key","evaluationCriterion","gradeValue","name","gradesAndLabels","gradeLabel","gradeLabelGrade","partial_arg","title","label","onClick","showGrades","mapi","gradeEcId","sort","renderGradePills","targetEvaluationCriteriaIds","e","gradeStatusClasses","color","status","submissionStatusIcon","overlaySubmission","evaluatedAt","evaluatorName","format","match$3","classes","gradeSubmission","showFeedbackForm","reviewChecklist","updateReviewChecklistCB","targetId","length","updateFeedbackCB","checklistVisible","reviewButtonDisabled","computeStatus","selectedGrades","passedAt","isNotEmpty","caml_equal","submitButtonText","noteForm","teamSubmission","_someGrades","noteAbout","help","children","textareaId","htmlFor","onChange","profile","maxLength","placeholder","CoursesReview__GradeCard","Props","useReducer","updateChecklistCB","pending","disabled","make$2","exports"],"mappings":"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","sourcesContent":["// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar Icon = require(\"../../../shared/Icon.bs.js\");\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\nvar Block = require(\"bs-platform/lib/js/block.js\");\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\nvar React = require(\"react\");\nvar FaIcon = require(\"../../../shared/components/FaIcon.bs.js\");\nvar Js_exn = require(\"bs-platform/lib/js/js_exn.js\");\nvar $$String = require(\"bs-platform/lib/js/string.js\");\nvar DateFns = require(\"../../../shared/utils/DateFns.bs.js\");\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\nvar Caml_obj = require(\"bs-platform/lib/js/caml_obj.js\");\nvar DomUtils = require(\"../../../shared/utils/DomUtils.bs.js\");\nvar HelpIcon = require(\"../../../shared/components/HelpIcon.bs.js\");\nvar Js_option = require(\"bs-platform/lib/js/js_option.js\");\nvar ArrayUtils = require(\"../../../shared/utils/ArrayUtils.bs.js\");\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\nvar GradeLabel = require(\"../../../shared/types/GradeLabel.bs.js\");\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\nvar OptionUtils = require(\"../../../shared/utils/OptionUtils.bs.js\");\nvar GraphqlQuery = require(\"../../../shared/utils/GraphqlQuery.bs.js\");\nvar DisablingCover = require(\"../../../shared/components/DisablingCover.bs.js\");\nvar MarkdownEditor = require(\"../../../shared/components/MarkdownEditor.bs.js\");\nvar EvaluationCriterion = require(\"../../../shared/types/EvaluationCriterion.bs.js\");\nvar CoursesReview__Grade = require(\"../types/CoursesReview__Grade.bs.js\");\nvar SubmissionChecklistItem = require(\"../types/SubmissionChecklistItem.bs.js\");\nvar SubmissionChecklistShow = require(\"./SubmissionChecklistShow.bs.js\");\nvar CoursesReview__FeedbackEditor = require(\"./CoursesReview__FeedbackEditor.bs.js\");\nvar CoursesReview__OverlaySubmission = require(\"../types/CoursesReview__OverlaySubmission.bs.js\");\n\n((require(\"./CoursesReview__GradeCard.css\")));\n\nfunction str(prim) {\n  return prim;\n}\n\nfunction reducer(state, action) {\n  if (typeof action === \"number\") {\n    if (action === /* BeginSaving */0) {\n      return {\n              grades: state.grades,\n              newFeedback: state.newFeedback,\n              saving: true,\n              checklist: state.checklist,\n              note: state.note\n            };\n    } else {\n      return {\n              grades: state.grades,\n              newFeedback: state.newFeedback,\n              saving: false,\n              checklist: state.checklist,\n              note: state.note\n            };\n    }\n  } else {\n    switch (action.tag | 0) {\n      case /* UpdateFeedback */0 :\n          return {\n                  grades: state.grades,\n                  newFeedback: action[0],\n                  saving: state.saving,\n                  checklist: state.checklist,\n                  note: state.note\n                };\n      case /* UpdateGrades */1 :\n          return {\n                  grades: action[0],\n                  newFeedback: state.newFeedback,\n                  saving: state.saving,\n                  checklist: state.checklist,\n                  note: state.note\n                };\n      case /* UpdateChecklist */2 :\n          return {\n                  grades: state.grades,\n                  newFeedback: state.newFeedback,\n                  saving: state.saving,\n                  checklist: action[0],\n                  note: state.note\n                };\n      case /* UpdateNote */3 :\n          return {\n                  grades: state.grades,\n                  newFeedback: state.newFeedback,\n                  saving: state.saving,\n                  checklist: state.checklist,\n                  note: action[0]\n                };\n      \n    }\n  }\n}\n\nfunction passed(grades, evaluationCriteria) {\n  return ArrayUtils.isEmpty(grades.filter((function (g) {\n                    var passGrade = EvaluationCriterion.passGrade(ArrayUtils.unsafeFind((function (ec) {\n                                return EvaluationCriterion.id(ec) === CoursesReview__Grade.evaluationCriterionId(g);\n                              }), \"CoursesReview__GradeCard: Unable to find evaluation criterion with id - \" + CoursesReview__Grade.evaluationCriterionId(g), evaluationCriteria));\n                    return CoursesReview__Grade.value(g) < passGrade;\n                  })));\n}\n\nvar ppx_printed_query = \"mutation CreateGradingMutation($submissionId: ID!, $feedback: String, $grades: [GradeInput!]!, $note: String, $checklist: JSON!)  {\\ncreateGrading(submissionId: $submissionId, feedback: $feedback, grades: $grades, note: $note, checklist: $checklist)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"createGrading\");\n  var tmp;\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type CreateGradingPayload is missing\");\n    }\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field createGrading on type Mutation is missing\");\n  }\n  return {\n          createGrading: tmp\n        };\n}\n\nfunction json_of_GradeInput(value) {\n  return Js_dict.fromArray([\n                /* tuple */[\n                  \"evaluationCriterionId\",\n                  value.evaluationCriterionId\n                ],\n                /* tuple */[\n                  \"grade\",\n                  value.grade\n                ]\n              ].filter((function (param) {\n                    return !Js_json.test(param[1], /* Null */5);\n                  })));\n}\n\nfunction make(submissionId, feedback, grades, note, checklist, param) {\n  return {\n          query: ppx_printed_query,\n          variables: Js_dict.fromArray([\n                  /* tuple */[\n                    \"submissionId\",\n                    submissionId\n                  ],\n                  /* tuple */[\n                    \"feedback\",\n                    feedback !== undefined ? feedback : null\n                  ],\n                  /* tuple */[\n                    \"grades\",\n                    grades.map(json_of_GradeInput)\n                  ],\n                  /* tuple */[\n                    \"note\",\n                    note !== undefined ? note : null\n                  ],\n                  /* tuple */[\n                    \"checklist\",\n                    checklist\n                  ]\n                ].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse\n        };\n}\n\nfunction makeWithVariables(variables) {\n  var submissionId = variables.submissionId;\n  var feedback = variables.feedback;\n  var grades = variables.grades;\n  var note = variables.note;\n  var checklist = variables.checklist;\n  return {\n          query: ppx_printed_query,\n          variables: Js_dict.fromArray([\n                  /* tuple */[\n                    \"submissionId\",\n                    submissionId\n                  ],\n                  /* tuple */[\n                    \"feedback\",\n                    feedback !== undefined ? feedback : null\n                  ],\n                  /* tuple */[\n                    \"grades\",\n                    grades.map(json_of_GradeInput)\n                  ],\n                  /* tuple */[\n                    \"note\",\n                    note !== undefined ? note : null\n                  ],\n                  /* tuple */[\n                    \"checklist\",\n                    checklist\n                  ]\n                ].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse\n        };\n}\n\nfunction makeVariables(submissionId, feedback, grades, note, checklist, param) {\n  return Js_dict.fromArray([\n                /* tuple */[\n                  \"submissionId\",\n                  submissionId\n                ],\n                /* tuple */[\n                  \"feedback\",\n                  feedback !== undefined ? feedback : null\n                ],\n                /* tuple */[\n                  \"grades\",\n                  grades.map(json_of_GradeInput)\n                ],\n                /* tuple */[\n                  \"note\",\n                  note !== undefined ? note : null\n                ],\n                /* tuple */[\n                  \"checklist\",\n                  checklist\n                ]\n              ].filter((function (param) {\n                    return !Js_json.test(param[1], /* Null */5);\n                  })));\n}\n\nfunction definition_002(graphql_ppx_use_json_variables_fn, submissionId, feedback, grades, note, checklist, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([\n                    /* tuple */[\n                      \"submissionId\",\n                      submissionId\n                    ],\n                    /* tuple */[\n                      \"feedback\",\n                      feedback !== undefined ? feedback : null\n                    ],\n                    /* tuple */[\n                      \"grades\",\n                      grades.map(json_of_GradeInput)\n                    ],\n                    /* tuple */[\n                      \"note\",\n                      note !== undefined ? note : null\n                    ],\n                    /* tuple */[\n                      \"checklist\",\n                      checklist\n                    ]\n                  ].filter((function (param) {\n                        return !Js_json.test(param[1], /* Null */5);\n                      }))));\n}\n\nvar definition = /* tuple */[\n  parse,\n  ppx_printed_query,\n  definition_002\n];\n\nfunction ret_type(f) {\n  return { };\n}\n\nvar MT_Ret = { };\n\nvar CreateGradingMutation = {\n  ppx_printed_query: ppx_printed_query,\n  query: ppx_printed_query,\n  parse: parse,\n  json_of_GradeInput: json_of_GradeInput,\n  make: make,\n  makeWithVariables: makeWithVariables,\n  makeVariables: makeVariables,\n  definition: definition,\n  ret_type: ret_type,\n  MT_Ret: MT_Ret\n};\n\nvar ppx_printed_query$1 = \"mutation UndoGradingMutation($submissionId: ID!)  {\\nundoGrading(submissionId: $submissionId)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse$1(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"undoGrading\");\n  var tmp;\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type UndoGradingPayload is missing\");\n    }\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field undoGrading on type Mutation is missing\");\n  }\n  return {\n          undoGrading: tmp\n        };\n}\n\nfunction make$1(submissionId, param) {\n  return {\n          query: ppx_printed_query$1,\n          variables: Js_dict.fromArray([/* tuple */[\n                    \"submissionId\",\n                    submissionId\n                  ]].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse$1\n        };\n}\n\nfunction makeWithVariables$1(variables) {\n  var submissionId = variables.submissionId;\n  return {\n          query: ppx_printed_query$1,\n          variables: Js_dict.fromArray([/* tuple */[\n                    \"submissionId\",\n                    submissionId\n                  ]].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse$1\n        };\n}\n\nfunction makeVariables$1(submissionId, param) {\n  return Js_dict.fromArray([/* tuple */[\n                  \"submissionId\",\n                  submissionId\n                ]].filter((function (param) {\n                    return !Js_json.test(param[1], /* Null */5);\n                  })));\n}\n\nfunction definition_002$1(graphql_ppx_use_json_variables_fn, submissionId, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([/* tuple */[\n                      \"submissionId\",\n                      submissionId\n                    ]].filter((function (param) {\n                        return !Js_json.test(param[1], /* Null */5);\n                      }))));\n}\n\nvar definition$1 = /* tuple */[\n  parse$1,\n  ppx_printed_query$1,\n  definition_002$1\n];\n\nfunction ret_type$1(f) {\n  return { };\n}\n\nvar MT_Ret$1 = { };\n\nvar UndoGradingMutation = {\n  ppx_printed_query: ppx_printed_query$1,\n  query: ppx_printed_query$1,\n  parse: parse$1,\n  make: make$1,\n  makeWithVariables: makeWithVariables$1,\n  makeVariables: makeVariables$1,\n  definition: definition$1,\n  ret_type: ret_type$1,\n  MT_Ret: MT_Ret$1\n};\n\nfunction undoGrading(submissionId, send) {\n  Curry._1(send, /* BeginSaving */0);\n  (function (eta) {\n          return GraphqlQuery.sendQuery(undefined, eta);\n        })(make$1(submissionId, /* () */0)).then((function (response) {\n          if (response.undoGrading.success) {\n            DomUtils.reload(/* () */0);\n          } else {\n            Curry._1(send, /* FinishSaving */1);\n          }\n          return Promise.resolve(/* () */0);\n        }));\n  return /* () */0;\n}\n\nfunction trimToOption(s) {\n  var s$1 = $$String.trim(s);\n  if (s$1 === \"\") {\n    return ;\n  } else {\n    return s$1;\n  }\n}\n\nfunction gradeSubmissionQuery(submissionId, state, send, evaluationCriteria, addGradingCB) {\n  var jsGradesArray = $$Array.map(CoursesReview__Grade.asJsType, state.grades);\n  var checklist = SubmissionChecklistItem.encodeArray(state.checklist);\n  Curry._1(send, /* BeginSaving */0);\n  var feedback = trimToOption(state.newFeedback);\n  var note = OptionUtils.flatMap(trimToOption, state.note);\n  (function (eta) {\n          return GraphqlQuery.sendQuery(undefined, eta);\n        })(make(submissionId, feedback, jsGradesArray, note, checklist, /* () */0)).then((function (response) {\n          if (response.createGrading.success) {\n            Curry._4(addGradingCB, state.newFeedback, passed(state.grades, evaluationCriteria), state.grades, state.checklist);\n          }\n          Curry._1(send, /* FinishSaving */1);\n          return Promise.resolve(/* () */0);\n        }));\n  return /* () */0;\n}\n\nfunction updateGrading(grade, state, send) {\n  var newGrades = $$Array.append([grade], state.grades.filter((function (g) {\n              return CoursesReview__Grade.evaluationCriterionId(g) !== CoursesReview__Grade.evaluationCriterionId(grade);\n            })));\n  return Curry._1(send, /* UpdateGrades */Block.__(1, [newGrades]));\n}\n\nfunction handleGradePillClick(evaluationCriterionId, value, state, send, $$event) {\n  $$event.preventDefault();\n  if (send !== undefined) {\n    return updateGrading(CoursesReview__Grade.make(evaluationCriterionId, value), state, send);\n  } else {\n    return /* () */0;\n  }\n}\n\nfunction findEvaluationCriterion(evaluationCriteria, evaluationCriterionId) {\n  var match = evaluationCriteria.find((function (ec) {\n          return EvaluationCriterion.id(ec) === evaluationCriterionId;\n        }));\n  if (match !== undefined) {\n    return match;\n  } else {\n    Rollbar.error(\"Unable to find evaluation Criterion with id: \" + (evaluationCriterionId + \"in CoursesRevew__GradeCard\"));\n    return Caml_array.caml_array_get(evaluationCriteria, 0);\n  }\n}\n\nfunction gradePillHeader(evaluationCriteriaName, selectedGrade, gradeLabels) {\n  return React.createElement(\"div\", {\n              className: \"flex justify-between\"\n            }, React.createElement(\"p\", {\n                  className: \"text-xs font-semibold\"\n                }, evaluationCriteriaName), React.createElement(\"p\", {\n                  className: \"text-xs font-semibold\"\n                }, String(selectedGrade) + (\"/\" + String(GradeLabel.maxGrade($$Array.to_list(gradeLabels))))));\n}\n\nfunction gradePillClasses(selectedGrade, currentGrade, passgrade, send) {\n  var defaultClasses = \"course-review-grade-card__grade-pill border-gray-400 py-1 px-2 text-sm flex-1 font-semibold \" + (\n    send !== undefined ? \"cursor-pointer hover:shadow-lg focus:outline-none \" + (\n        Caml_obj.caml_greaterequal(currentGrade, passgrade) ? \"hover:bg-green-500 hover:text-white \" : \"hover:bg-red-500 hover:text-white \"\n      ) : \"\"\n  );\n  return defaultClasses + (\n          Caml_obj.caml_lessequal(currentGrade, selectedGrade) ? (\n              Caml_obj.caml_greaterequal(selectedGrade, passgrade) ? \"bg-green-500 text-white shadow-lg\" : \"bg-red-500 text-white shadow-lg\"\n            ) : \"bg-white text-gray-900\"\n        );\n}\n\nfunction showGradePill(key, evaluationCriterion, gradeValue, passGrade, state, send) {\n  return React.createElement(\"div\", {\n              key: String(key),\n              \"aria-label\": \"evaluation-criterion-\" + EvaluationCriterion.id(evaluationCriterion),\n              className: \"md:pr-8 mt-4\"\n            }, gradePillHeader(EvaluationCriterion.name(evaluationCriterion), gradeValue, EvaluationCriterion.gradesAndLabels(evaluationCriterion)), React.createElement(\"div\", {\n                  className: \"course-review-grade-card__grade-bar inline-flex w-full text-center mt-1\"\n                }, $$Array.map((function (gradeLabel) {\n                        var gradeLabelGrade = GradeLabel.grade(gradeLabel);\n                        var partial_arg = EvaluationCriterion.id(evaluationCriterion);\n                        return React.createElement(\"div\", {\n                                    key: String(gradeLabelGrade),\n                                    className: gradePillClasses(gradeValue, gradeLabelGrade, passGrade, send),\n                                    title: GradeLabel.label(gradeLabel),\n                                    onClick: (function (param) {\n                                        return handleGradePillClick(partial_arg, gradeLabelGrade, state, send, param);\n                                      })\n                                  }, send !== undefined ? String(gradeLabelGrade) : null);\n                      }), EvaluationCriterion.gradesAndLabels(evaluationCriterion))));\n}\n\nfunction showGrades(grades, evaluationCriteria, state) {\n  return React.createElement(\"div\", undefined, $$Array.mapi((function (key, grade) {\n                    var gradeEcId = CoursesReview__Grade.evaluationCriterionId(grade);\n                    var ec = ArrayUtils.unsafeFind((function (ec) {\n                            return EvaluationCriterion.id(ec) === gradeEcId;\n                          }), \"Unable to find evaluation Criterion with id: \" + (gradeEcId + \"in CoursesRevew__GradeCard\"), evaluationCriteria);\n                    return showGradePill(key, ec, CoursesReview__Grade.value(grade), EvaluationCriterion.passGrade(ec), state, undefined);\n                  }), CoursesReview__Grade.sort(evaluationCriteria, grades)));\n}\n\nfunction renderGradePills(evaluationCriteria, targetEvaluationCriteriaIds, state, send) {\n  return $$Array.mapi((function (key, evaluationCriterionId) {\n                var ec = ArrayUtils.unsafeFind((function (e) {\n                        return EvaluationCriterion.id(e) === evaluationCriterionId;\n                      }), \"CoursesReview__GradeCard: Unable to find evaluation criterion with id - \" + evaluationCriterionId, evaluationCriteria);\n                var grade = state.grades.find((function (g) {\n                        return CoursesReview__Grade.evaluationCriterionId(g) === EvaluationCriterion.id(ec);\n                      }));\n                var gradeValue = grade !== undefined ? CoursesReview__Grade.value(grade) : 0;\n                var passGrade = EvaluationCriterion.passGrade(ec);\n                return showGradePill(key, ec, gradeValue, passGrade, state, send);\n              }), targetEvaluationCriteriaIds);\n}\n\nfunction gradeStatusClasses(color, status) {\n  return \"w-12 h-10 p-1 mr-2 md:mr-0 md:w-24 md:h-20 rounded md:rounded-lg border flex justify-center items-center bg-\" + (color + (\"-100 border-\" + (color + (\"-400 \" + (\n                  typeof status === \"number\" && status === 0 ? \"course-review-grade-card__status-pulse\" : \"\"\n                )))));\n}\n\nfunction submissionStatusIcon(status, overlaySubmission, send) {\n  var match = typeof status === \"number\" ? (\n      status !== 0 ? /* tuple */[\n          \"Not Reviewed\",\n          \"gray\"\n        ] : /* tuple */[\n          \"Reviewing\",\n          \"orange\"\n        ]\n    ) : (\n      status[0] ? /* tuple */[\n          \"Passed\",\n          \"green\"\n        ] : /* tuple */[\n          \"Failed\",\n          \"red\"\n        ]\n    );\n  var color = match[1];\n  var match$1 = CoursesReview__OverlaySubmission.evaluatedAt(overlaySubmission);\n  var tmp;\n  if (match$1 !== undefined && typeof status !== \"number\") {\n    var match$2 = CoursesReview__OverlaySubmission.evaluatorName(overlaySubmission);\n    tmp = React.createElement(\"div\", {\n          className: \"bg-gray-200 block md:flex flex-col w-full justify-between rounded-lg pt-3 mr-2 mt-4 md:mt-0\"\n        }, React.createElement(\"div\", undefined, React.createElement(\"p\", {\n                  className: \"text-xs px-3\"\n                }, \"Evaluated By\"), React.createElement(\"p\", {\n                  className: \"text-sm font-semibold px-3 pb-3\"\n                }, match$2 !== undefined ? match$2 : React.createElement(\"em\", undefined, \"Deleted Coach\"))), React.createElement(\"div\", {\n              className: \"text-xs bg-gray-300 flex items-center rounded-b-lg px-3 py-2 md:px-3 md:py-1\"\n            }, \"on \" + DateFns.format(Caml_option.valFromOption(match$1), \"MMMM d, yyyy\")));\n  } else {\n    tmp = null;\n  }\n  var match$3 = CoursesReview__OverlaySubmission.evaluatedAt(overlaySubmission);\n  return React.createElement(\"div\", {\n              \"aria-label\": \"submission-status\",\n              className: \"flex w-full md:w-3/6 flex-col items-center justify-center md:border-l mt-4 md:mt-0\"\n            }, React.createElement(\"div\", {\n                  className: \"flex flex-col-reverse md:flex-row items-start md:items-stretch justify-center w-full md:pl-6\"\n                }, tmp, React.createElement(\"div\", {\n                      className: \"w-full md:w-24 flex flex-row md:flex-col md:items-center justify-center\"\n                    }, React.createElement(\"div\", {\n                          className: gradeStatusClasses(color, status)\n                        }, typeof status === \"number\" ? (\n                            status !== 0 ? React.createElement(Icon.make, {\n                                    className: \"if i-eye-solid text-xl md:text-4xl text-gray-400\"\n                                  }) : React.createElement(Icon.make, {\n                                    className: \"if i-writing-pad-solid text-xl md:text-5xl text-orange-300\"\n                                  })\n                          ) : (\n                            status[0] ? React.createElement(Icon.make, {\n                                    className: \"if i-badge-check-solid text-xl md:text-5xl text-green-500\"\n                                  }) : React.createElement(FaIcon.make, {\n                                    classes: \"fas fa-exclamation-triangle text-xl md:text-4xl text-red-500\"\n                                  })\n                          )), React.createElement(\"p\", {\n                          className: \"text-xs flex items-center justify-center md:block text-center w-full border rounded px-1 py-px font-semibold md:mt-1 border-\" + (color + (\"-400 bg-\" + (color + (\"-100 text-\" + (color + \"-800 \")))))\n                        }, match[0]))), match$3 !== undefined && typeof status !== \"number\" ? React.createElement(\"div\", {\n                    className: \"mt-4 md:pl-6 w-full\"\n                  }, React.createElement(\"button\", {\n                        className: \"btn btn-danger btn-small\",\n                        onClick: (function (param) {\n                            return undoGrading(CoursesReview__OverlaySubmission.id(overlaySubmission), send);\n                          })\n                      }, React.createElement(\"i\", {\n                            className: \"fas fa-undo\"\n                          }), React.createElement(\"span\", {\n                            className: \"ml-2\"\n                          }, \"Undo Grading\"))) : null);\n}\n\nfunction gradeSubmission(submissionId, state, send, evaluationCriteria, addGradingCB, status, $$event) {\n  $$event.preventDefault();\n  if (typeof status === \"number\") {\n    return /* () */0;\n  } else {\n    return gradeSubmissionQuery(submissionId, state, send, evaluationCriteria, addGradingCB);\n  }\n}\n\nfunction showFeedbackForm(grades, reviewChecklist, updateReviewChecklistCB, state, send, targetId) {\n  if (grades.length !== 0) {\n    return null;\n  } else {\n    return React.createElement(CoursesReview__FeedbackEditor.make, {\n                feedback: state.newFeedback,\n                updateFeedbackCB: (function (feedback) {\n                    return Curry._1(send, /* UpdateFeedback */Block.__(0, [feedback]));\n                  }),\n                label: \"Add Your Feedback\",\n                reviewChecklist: reviewChecklist,\n                updateReviewChecklistCB: updateReviewChecklistCB,\n                checklistVisible: true,\n                targetId: targetId\n              });\n  }\n}\n\nfunction reviewButtonDisabled(status) {\n  if (typeof status === \"number\") {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction computeStatus(overlaySubmission, selectedGrades, evaluationCriteria) {\n  var match = CoursesReview__OverlaySubmission.passedAt(overlaySubmission);\n  var match$1 = ArrayUtils.isNotEmpty(CoursesReview__OverlaySubmission.grades(overlaySubmission));\n  if (match !== undefined) {\n    return /* Graded */[true];\n  } else if (match$1) {\n    return /* Graded */[false];\n  } else if (Caml_obj.caml_equal(selectedGrades, [])) {\n    return /* Ungraded */1;\n  } else if (selectedGrades.length !== evaluationCriteria.length) {\n    return /* Grading */0;\n  } else {\n    return /* Graded */[passed(selectedGrades, evaluationCriteria)];\n  }\n}\n\nfunction submitButtonText(feedback, grades) {\n  var match = feedback !== \"\";\n  ArrayUtils.isNotEmpty(grades);\n  if (match) {\n    return \"Save grades & send feedback\";\n  } else {\n    return \"Save grades\";\n  }\n}\n\nfunction noteForm(overlaySubmission, teamSubmission, note, send) {\n  var _someGrades = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  if (_someGrades.length !== 0) {\n    return null;\n  } else {\n    var match = teamSubmission ? /* tuple */[\n        \"team\",\n        \" This submission is from a team, so a note added here will be posted to the report of all students in the team.\"\n      ] : /* tuple */[\n        \"student\",\n        \"\"\n      ];\n    var noteAbout = match[0];\n    var help = React.createElement(HelpIcon.make, {\n          className: \"ml-1\",\n          children: \"Notes can be used to keep track of a \" + (noteAbout + (\"'s progress. These notes are shown only to coaches in a student's report.\" + match[1]))\n        });\n    var textareaId = \"note-for-submission-\" + CoursesReview__OverlaySubmission.id(overlaySubmission);\n    return React.createElement(\"div\", {\n                className: \"text-sm\"\n              }, React.createElement(\"h5\", {\n                    className: \"font-semibold text-sm flex items-center\"\n                  }, React.createElement(\"i\", {\n                        className: \"far fa-sticky-note text-gray-800 text-base\"\n                      }), note !== undefined ? React.createElement(\"span\", {\n                          className: \"ml-2 md:ml-3 tracking-wide\"\n                        }, React.createElement(\"label\", {\n                              htmlFor: textareaId\n                            }, \"Write a Note\"), help) : React.createElement(\"div\", {\n                          className: \"ml-2 md:ml-3 tracking-wide flex justify-between items-center w-full\"\n                        }, React.createElement(\"span\", undefined, React.createElement(\"span\", undefined, \"Would you like to write a note about this \" + (noteAbout + \"?\")), help), React.createElement(\"button\", {\n                              className: \"btn btn-small btn-primary-ghost ml-1\",\n                              onClick: (function (param) {\n                                  return Curry._1(send, /* UpdateNote */Block.__(3, [\"\"]));\n                                })\n                            }, \"Write a Note\"))), note !== undefined ? React.createElement(\"div\", {\n                      className: \"ml-6 md:ml-7 mt-2\"\n                    }, React.createElement(MarkdownEditor.make, {\n                          value: note,\n                          onChange: (function (value) {\n                              return Curry._1(send, /* UpdateNote */Block.__(3, [value]));\n                            }),\n                          profile: /* Permissive */2,\n                          textareaId: textareaId,\n                          maxLength: 10000,\n                          placeholder: \"Did you notice something while reviewing this submission?\"\n                        })) : null);\n  }\n}\n\nfunction CoursesReview__GradeCard(Props) {\n  var overlaySubmission = Props.overlaySubmission;\n  var teamSubmission = Props.teamSubmission;\n  var evaluationCriteria = Props.evaluationCriteria;\n  var reviewChecklist = Props.reviewChecklist;\n  var addGradingCB = Props.addGradingCB;\n  var updateReviewChecklistCB = Props.updateReviewChecklistCB;\n  var targetId = Props.targetId;\n  var targetEvaluationCriteriaIds = Props.targetEvaluationCriteriaIds;\n  var match = React.useReducer(reducer, {\n        grades: [],\n        newFeedback: \"\",\n        saving: false,\n        checklist: CoursesReview__OverlaySubmission.checklist(overlaySubmission),\n        note: undefined\n      });\n  var send = match[1];\n  var state = match[0];\n  var status = computeStatus(overlaySubmission, state.grades, evaluationCriteria);\n  var match$1 = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var updateChecklistCB = match$1.length !== 0 ? undefined : (function (checklist) {\n        return Curry._1(send, /* UpdateChecklist */Block.__(2, [checklist]));\n      });\n  var pending = ArrayUtils.isEmpty(CoursesReview__OverlaySubmission.grades(overlaySubmission));\n  var grades = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var match$2 = CoursesReview__OverlaySubmission.grades(overlaySubmission);\n  var tmp;\n  if (match$2.length !== 0) {\n    tmp = null;\n  } else {\n    var partial_arg = CoursesReview__OverlaySubmission.id(overlaySubmission);\n    tmp = React.createElement(\"div\", {\n          className: \"bg-white pt-4 mr-4 ml-4 md:mr-6 md:ml-13\"\n        }, React.createElement(\"button\", {\n              className: \"btn btn-success btn-large w-full border border-green-600\",\n              disabled: reviewButtonDisabled(status),\n              onClick: (function (param) {\n                  return gradeSubmission(partial_arg, state, send, evaluationCriteria, addGradingCB, status, param);\n                })\n            }, submitButtonText(state.newFeedback, state.grades)));\n  }\n  return React.createElement(DisablingCover.make, {\n              disabled: state.saving,\n              children: null\n            }, React.createElement(\"div\", undefined, React.createElement(\"div\", {\n                      className: \"pt-2 pb-6 px-4 md:px-6 bg-gray-100 border-b\"\n                    }, React.createElement(SubmissionChecklistShow.make, {\n                          checklist: state.checklist,\n                          updateChecklistCB: updateChecklistCB,\n                          pending: pending\n                        })), showFeedbackForm(CoursesReview__OverlaySubmission.grades(overlaySubmission), reviewChecklist, updateReviewChecklistCB, state, send, targetId), React.createElement(\"div\", {\n                      className: \"w-full px-4 pt-4 md:px-6 md:pt-6\"\n                    }, noteForm(overlaySubmission, teamSubmission, state.note, send), React.createElement(\"h5\", {\n                          className: \"font-semibold text-sm flex items-center mt-4 md:mt-6\"\n                        }, React.createElement(Icon.make, {\n                              className: \"if i-tachometer-regular text-gray-800 text-base\"\n                            }), React.createElement(\"span\", {\n                              className: \"ml-2 md:ml-3 tracking-wide\"\n                            }, \"Grade Card\")), React.createElement(\"div\", {\n                          className: \"flex md:flex-row flex-col border md:ml-7 bg-gray-100 p-2 md:p-4 rounded-lg mt-2\"\n                        }, React.createElement(\"div\", {\n                              className: \"w-full md:w-3/6\"\n                            }, grades.length !== 0 ? showGrades(grades, evaluationCriteria, state) : renderGradePills(evaluationCriteria, targetEvaluationCriteriaIds, state, send)), submissionStatusIcon(status, overlaySubmission, send)))), tmp);\n}\n\nvar make$2 = CoursesReview__GradeCard;\n\nexports.str = str;\nexports.reducer = reducer;\nexports.passed = passed;\nexports.CreateGradingMutation = CreateGradingMutation;\nexports.UndoGradingMutation = UndoGradingMutation;\nexports.undoGrading = undoGrading;\nexports.trimToOption = trimToOption;\nexports.gradeSubmissionQuery = gradeSubmissionQuery;\nexports.updateGrading = updateGrading;\nexports.handleGradePillClick = handleGradePillClick;\nexports.findEvaluationCriterion = findEvaluationCriterion;\nexports.gradePillHeader = gradePillHeader;\nexports.gradePillClasses = gradePillClasses;\nexports.showGradePill = showGradePill;\nexports.showGrades = showGrades;\nexports.renderGradePills = renderGradePills;\nexports.gradeStatusClasses = gradeStatusClasses;\nexports.submissionStatusIcon = submissionStatusIcon;\nexports.gradeSubmission = gradeSubmission;\nexports.showFeedbackForm = showFeedbackForm;\nexports.reviewButtonDisabled = reviewButtonDisabled;\nexports.computeStatus = computeStatus;\nexports.submitButtonText = submitButtonText;\nexports.noteForm = noteForm;\nexports.make = make$2;\n/*  Not a pure module */\n"]},"metadata":{},"sourceType":"module"}