{"ast":null,"code":"// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar List = require(\"bs-platform/lib/js/list.js\");\n\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\n\nvar Block = require(\"bs-platform/lib/js/block.js\");\n\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\n\nvar Fetch = require(\"bs-fetch/src/Fetch.js\");\n\nvar React = require(\"react\");\n\nvar Random = require(\"bs-platform/lib/js/random.js\");\n\nvar ListUtils = require(\"../../../shared/utils/ListUtils.bs.js\");\n\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\n\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\n\nvar Json_decode = require(\"@glennsl/bs-json/src/Json_decode.bs.js\");\n\nvar $$Notification = require(\"../../../shared/Notification.bs.js\");\n\nvar Caml_exceptions = require(\"bs-platform/lib/js/caml_exceptions.js\");\n\nvar AuthenticityToken = require(\"../../../shared/utils/AuthenticityToken.bs.js\");\n\nvar FormNotFound = Caml_exceptions.create(\"CoursesCurriculum__FileForm.FormNotFound\");\nvar UnexpectedResponse = Caml_exceptions.create(\"CoursesCurriculum__FileForm.UnexpectedResponse\");\n\nfunction str(prim) {\n  return prim;\n}\n\nvar defaultTitle = \"Choose file to upload\";\n\nfunction reducer(state, action) {\n  if (typeof action === \"number\") {\n    return {\n      formId: state.formId,\n      filename: defaultTitle,\n      errors:\n      /* [] */\n      0\n    };\n  } else if (action.tag) {\n    return {\n      formId: state.formId,\n      filename: action[0],\n      errors: action[1]\n    };\n  } else {\n    return {\n      formId: state.formId,\n      filename: action[0],\n      errors:\n      /* [] */\n      0\n    };\n  }\n}\n\nfunction handleResponseJSON(filename, send, attachFileCB, json) {\n  var id = Json_decode.field(\"id\", Json_decode.string, json);\n\n  Curry._2(attachFileCB, id, filename);\n\n  return Curry._1(send,\n  /* ResetForm */\n  0);\n}\n\nfunction handleApiError(match) {\n  if (Caml_exceptions.caml_is_extension(match) && match[0] === UnexpectedResponse) {\n    return match[1];\n  }\n}\n\nfunction uploadFile(filename, send, attachFileCB, formData) {\n  fetch(\"/timeline_event_files/\", Fetch.RequestInit.make(\n  /* Post */\n  2, undefined, Caml_option.some(formData), undefined, undefined, undefined,\n  /* SameOrigin */\n  1, undefined, undefined, undefined, undefined, undefined)(\n  /* () */\n  0)).then(function (response) {\n    if (response.ok) {\n      return response.json();\n    } else {\n      return Promise.reject([UnexpectedResponse, response.status]);\n    }\n  }).then(function (json) {\n    return Promise.resolve(handleResponseJSON(filename, send, attachFileCB, json));\n  })[\"catch\"](function (error) {\n    var match = handleApiError(error);\n    return Promise.resolve(match !== undefined ? $$Notification.error(\"Error \" + String(match), \"Please reload the page and try again.\") : $$Notification.error(\"Something went wrong!\", \"Our team has been notified of this error. Please reload the page and try again.\"));\n  });\n  return (\n    /* () */\n    0\n  );\n}\n\nfunction submitForm(filename, formId, send, addFileAttachmentCB) {\n  var element = document.getElementById(formId);\n\n  if (element == null) {\n    throw [FormNotFound, formId];\n  } else {\n    return uploadFile(filename, send, addFileAttachmentCB, new FormData(element));\n  }\n}\n\nfunction attachFile(state, send, attachingCB, attachFileCB, preview, $$event) {\n  if (preview) {\n    return $$Notification.notice(\"Preview Mode\", \"You cannot attach files.\");\n  } else {\n    var files = $$event.target.files;\n\n    if (files.length !== 0) {\n      var file = Caml_array.caml_array_get(files, 0);\n      var errors = file.size > 5242880 ?\n      /* :: */\n      [\"The maximum file size is 5 MB.\",\n      /* [] */\n      0] :\n      /* [] */\n      0;\n\n      if (ListUtils.isEmpty(errors)) {\n        var filename = file.name;\n\n        Curry._1(attachingCB, true);\n\n        Curry._1(send,\n        /* AttachFile */\n        Block.__(0, [filename]));\n\n        return submitForm(filename, state.formId, send, attachFileCB);\n      } else {\n        return Curry._1(send,\n        /* SelectFile */\n        Block.__(1, [file.name, errors]));\n      }\n    } else {\n      return (\n        /* () */\n        0\n      );\n    }\n  }\n}\n\nfunction CoursesCurriculum__FileForm(Props) {\n  var attachFileCB = Props.attachFileCB;\n  var attachingCB = Props.attachingCB;\n  var preview = Props.preview;\n  var match = React.useReducer(reducer, {\n    formId: String(Random.$$int(99999)),\n    filename: defaultTitle,\n    errors:\n    /* [] */\n    0\n  });\n  var send = match[1];\n  var state = match[0];\n  return React.createElement(\"div\", undefined, React.createElement(\"form\", {\n    className: \"flex items-center flex-wrap\",\n    id: state.formId\n  }, React.createElement(\"input\", {\n    name: \"authenticity_token\",\n    type: \"hidden\",\n    value: AuthenticityToken.fromHead(\n    /* () */\n    0)\n  }), React.createElement(\"input\", {\n    className: \"hidden\",\n    id: \"attachment_file\",\n    multiple: false,\n    name: \"file\",\n    required: true,\n    type: \"file\",\n    onChange: function onChange(param) {\n      return attachFile(state, send, attachingCB, attachFileCB, preview, param);\n    }\n  }), React.createElement(\"label\", {\n    className: \"text-center cursor-pointer truncate bg-gray-200 border border-dashed border-gray-600 flex px-4 py-5 items-center font-semibold rounded text-sm hover:text-primary-600 hover:bg-primary-100 hover:border-primary-500 flex-grow\",\n    htmlFor: \"attachment_file\"\n  }, React.createElement(\"span\", {\n    className: \"w-full\"\n  }, React.createElement(\"i\", {\n    className: \"fas fa-upload mr-2 text-lg\"\n  }), React.createElement(\"span\", {\n    className: \"truncate\"\n  }, state.filename)))), $$Array.of_list(List.map(function (error) {\n    return React.createElement(\"div\", {\n      key: error,\n      className: \"mt-2 text-red-700 text-sm\"\n    }, React.createElement(\"i\", {\n      className: \"fas fa-exclamation-circle mr-2\"\n    }), React.createElement(\"span\", undefined, error));\n  }, state.errors)), ListUtils.isEmpty(state.errors) ? null : React.createElement(\"div\", {\n    className: \"px-4 mt-2 text-sm\"\n  }, \"Please choose another file for upload.\"));\n}\n\nvar make = CoursesCurriculum__FileForm;\nexports.FormNotFound = FormNotFound;\nexports.UnexpectedResponse = UnexpectedResponse;\nexports.str = str;\nexports.defaultTitle = defaultTitle;\nexports.reducer = reducer;\nexports.handleResponseJSON = handleResponseJSON;\nexports.handleApiError = handleApiError;\nexports.uploadFile = uploadFile;\nexports.submitForm = submitForm;\nexports.attachFile = attachFile;\nexports.make = make;\n/* react Not a pure module */","map":{"version":3,"sources":["/home/kochar/Documents/pupilfirst-master/app/javascript/courses/curricula/components/CoursesCurriculum__FileForm.bs.js"],"names":["List","require","$$Array","Block","Curry","Fetch","React","Random","ListUtils","Caml_array","Caml_option","Json_decode","$$Notification","Caml_exceptions","AuthenticityToken","FormNotFound","create","UnexpectedResponse","str","prim","defaultTitle","reducer","state","action","formId","filename","errors","tag","handleResponseJSON","send","attachFileCB","json","id","field","string","_2","_1","handleApiError","match","caml_is_extension","uploadFile","formData","fetch","RequestInit","make","undefined","some","then","response","ok","Promise","reject","status","resolve","error","String","submitForm","addFileAttachmentCB","element","document","getElementById","FormData","attachFile","attachingCB","preview","$$event","notice","files","target","length","file","caml_array_get","size","isEmpty","name","__","CoursesCurriculum__FileForm","Props","useReducer","$$int","createElement","className","type","value","fromHead","multiple","required","onChange","param","htmlFor","of_list","map","key","exports"],"mappings":"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","sourcesContent":["// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar List = require(\"bs-platform/lib/js/list.js\");\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\nvar Block = require(\"bs-platform/lib/js/block.js\");\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\nvar Fetch = require(\"bs-fetch/src/Fetch.js\");\nvar React = require(\"react\");\nvar Random = require(\"bs-platform/lib/js/random.js\");\nvar ListUtils = require(\"../../../shared/utils/ListUtils.bs.js\");\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\nvar Json_decode = require(\"@glennsl/bs-json/src/Json_decode.bs.js\");\nvar $$Notification = require(\"../../../shared/Notification.bs.js\");\nvar Caml_exceptions = require(\"bs-platform/lib/js/caml_exceptions.js\");\nvar AuthenticityToken = require(\"../../../shared/utils/AuthenticityToken.bs.js\");\n\nvar FormNotFound = Caml_exceptions.create(\"CoursesCurriculum__FileForm.FormNotFound\");\n\nvar UnexpectedResponse = Caml_exceptions.create(\"CoursesCurriculum__FileForm.UnexpectedResponse\");\n\nfunction str(prim) {\n  return prim;\n}\n\nvar defaultTitle = \"Choose file to upload\";\n\nfunction reducer(state, action) {\n  if (typeof action === \"number\") {\n    return {\n            formId: state.formId,\n            filename: defaultTitle,\n            errors: /* [] */0\n          };\n  } else if (action.tag) {\n    return {\n            formId: state.formId,\n            filename: action[0],\n            errors: action[1]\n          };\n  } else {\n    return {\n            formId: state.formId,\n            filename: action[0],\n            errors: /* [] */0\n          };\n  }\n}\n\nfunction handleResponseJSON(filename, send, attachFileCB, json) {\n  var id = Json_decode.field(\"id\", Json_decode.string, json);\n  Curry._2(attachFileCB, id, filename);\n  return Curry._1(send, /* ResetForm */0);\n}\n\nfunction handleApiError(match) {\n  if (Caml_exceptions.caml_is_extension(match) && match[0] === UnexpectedResponse) {\n    return match[1];\n  }\n  \n}\n\nfunction uploadFile(filename, send, attachFileCB, formData) {\n  fetch(\"/timeline_event_files/\", Fetch.RequestInit.make(/* Post */2, undefined, Caml_option.some(formData), undefined, undefined, undefined, /* SameOrigin */1, undefined, undefined, undefined, undefined, undefined)(/* () */0)).then((function (response) {\n              if (response.ok) {\n                return response.json();\n              } else {\n                return Promise.reject([\n                            UnexpectedResponse,\n                            response.status\n                          ]);\n              }\n            })).then((function (json) {\n            return Promise.resolve(handleResponseJSON(filename, send, attachFileCB, json));\n          })).catch((function (error) {\n          var match = handleApiError(error);\n          return Promise.resolve(match !== undefined ? $$Notification.error(\"Error \" + String(match), \"Please reload the page and try again.\") : $$Notification.error(\"Something went wrong!\", \"Our team has been notified of this error. Please reload the page and try again.\"));\n        }));\n  return /* () */0;\n}\n\nfunction submitForm(filename, formId, send, addFileAttachmentCB) {\n  var element = document.getElementById(formId);\n  if (element == null) {\n    throw [\n          FormNotFound,\n          formId\n        ];\n  } else {\n    return uploadFile(filename, send, addFileAttachmentCB, new FormData(element));\n  }\n}\n\nfunction attachFile(state, send, attachingCB, attachFileCB, preview, $$event) {\n  if (preview) {\n    return $$Notification.notice(\"Preview Mode\", \"You cannot attach files.\");\n  } else {\n    var files = $$event.target.files;\n    if (files.length !== 0) {\n      var file = Caml_array.caml_array_get(files, 0);\n      var errors = file.size > 5242880 ? /* :: */[\n          \"The maximum file size is 5 MB.\",\n          /* [] */0\n        ] : /* [] */0;\n      if (ListUtils.isEmpty(errors)) {\n        var filename = file.name;\n        Curry._1(attachingCB, true);\n        Curry._1(send, /* AttachFile */Block.__(0, [filename]));\n        return submitForm(filename, state.formId, send, attachFileCB);\n      } else {\n        return Curry._1(send, /* SelectFile */Block.__(1, [\n                      file.name,\n                      errors\n                    ]));\n      }\n    } else {\n      return /* () */0;\n    }\n  }\n}\n\nfunction CoursesCurriculum__FileForm(Props) {\n  var attachFileCB = Props.attachFileCB;\n  var attachingCB = Props.attachingCB;\n  var preview = Props.preview;\n  var match = React.useReducer(reducer, {\n        formId: String(Random.$$int(99999)),\n        filename: defaultTitle,\n        errors: /* [] */0\n      });\n  var send = match[1];\n  var state = match[0];\n  return React.createElement(\"div\", undefined, React.createElement(\"form\", {\n                  className: \"flex items-center flex-wrap\",\n                  id: state.formId\n                }, React.createElement(\"input\", {\n                      name: \"authenticity_token\",\n                      type: \"hidden\",\n                      value: AuthenticityToken.fromHead(/* () */0)\n                    }), React.createElement(\"input\", {\n                      className: \"hidden\",\n                      id: \"attachment_file\",\n                      multiple: false,\n                      name: \"file\",\n                      required: true,\n                      type: \"file\",\n                      onChange: (function (param) {\n                          return attachFile(state, send, attachingCB, attachFileCB, preview, param);\n                        })\n                    }), React.createElement(\"label\", {\n                      className: \"text-center cursor-pointer truncate bg-gray-200 border border-dashed border-gray-600 flex px-4 py-5 items-center font-semibold rounded text-sm hover:text-primary-600 hover:bg-primary-100 hover:border-primary-500 flex-grow\",\n                      htmlFor: \"attachment_file\"\n                    }, React.createElement(\"span\", {\n                          className: \"w-full\"\n                        }, React.createElement(\"i\", {\n                              className: \"fas fa-upload mr-2 text-lg\"\n                            }), React.createElement(\"span\", {\n                              className: \"truncate\"\n                            }, state.filename)))), $$Array.of_list(List.map((function (error) {\n                        return React.createElement(\"div\", {\n                                    key: error,\n                                    className: \"mt-2 text-red-700 text-sm\"\n                                  }, React.createElement(\"i\", {\n                                        className: \"fas fa-exclamation-circle mr-2\"\n                                      }), React.createElement(\"span\", undefined, error));\n                      }), state.errors)), ListUtils.isEmpty(state.errors) ? null : React.createElement(\"div\", {\n                    className: \"px-4 mt-2 text-sm\"\n                  }, \"Please choose another file for upload.\"));\n}\n\nvar make = CoursesCurriculum__FileForm;\n\nexports.FormNotFound = FormNotFound;\nexports.UnexpectedResponse = UnexpectedResponse;\nexports.str = str;\nexports.defaultTitle = defaultTitle;\nexports.reducer = reducer;\nexports.handleResponseJSON = handleResponseJSON;\nexports.handleApiError = handleApiError;\nexports.uploadFile = uploadFile;\nexports.submitForm = submitForm;\nexports.attachFile = attachFile;\nexports.make = make;\n/* react Not a pure module */\n"]},"metadata":{},"sourceType":"module"}