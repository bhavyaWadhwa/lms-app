{"ast":null,"code":"// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\n\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\n\nvar React = require(\"react\");\n\nvar Js_exn = require(\"bs-platform/lib/js/js_exn.js\");\n\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\n\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\n\nvar Caml_obj = require(\"bs-platform/lib/js/caml_obj.js\");\n\nvar Dropdown = require(\"../../../../shared/components/Dropdown.bs.js\");\n\nvar HelpIcon = require(\"../../../../shared/components/HelpIcon.bs.js\");\n\nvar Js_option = require(\"bs-platform/lib/js/js_option.js\");\n\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\n\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\n\nvar OptionUtils = require(\"../../../../shared/utils/OptionUtils.bs.js\");\n\nvar ContentBlock = require(\"../../../../shared/types/ContentBlock.bs.js\");\n\nvar GraphqlQuery = require(\"../../../../shared/utils/GraphqlQuery.bs.js\");\n\nvar SkeletonLoading = require(\"../../../../shared/components/SkeletonLoading.bs.js\");\n\nvar TargetContentView = require(\"../../../../shared/components/TargetContentView.bs.js\");\n\nvar CurriculumEditor__Version = require(\"../../types/curriculum_editor/CurriculumEditor__Version.bs.js\");\n\nfunction str(prim) {\n  return prim;\n}\n\nfunction reducer(_state, action) {\n  if (action) {\n    return (\n      /* Loaded */\n      [action[0], action[2], action[1]]\n    );\n  } else {\n    return (\n      /* Loading */\n      0\n    );\n  }\n}\n\nvar ppx_printed_query = \"mutation CreateTargetVersionMutation($targetVersionId: ID!)  {\\ncreateTargetVersion(targetVersionId: $targetVersionId)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"createTargetVersion\");\n  var tmp;\n\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type CreateTargetVersionPayload is missing\");\n    }\n\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field createTargetVersion on type Mutation is missing\");\n  }\n\n  return {\n    createTargetVersion: tmp\n  };\n}\n\nfunction make(targetVersionId, param) {\n  return {\n    query: ppx_printed_query,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"targetVersionId\", targetVersionId]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse\n  };\n}\n\nfunction makeWithVariables(variables) {\n  var targetVersionId = variables.targetVersionId;\n  return {\n    query: ppx_printed_query,\n    variables: Js_dict.fromArray([\n    /* tuple */\n    [\"targetVersionId\", targetVersionId]].filter(function (param) {\n      return !Js_json.test(param[1],\n      /* Null */\n      5);\n    })),\n    parse: parse\n  };\n}\n\nfunction makeVariables(targetVersionId, param) {\n  return Js_dict.fromArray([\n  /* tuple */\n  [\"targetVersionId\", targetVersionId]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  }));\n}\n\nfunction definition_002(graphql_ppx_use_json_variables_fn, targetVersionId, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([\n  /* tuple */\n  [\"targetVersionId\", targetVersionId]].filter(function (param) {\n    return !Js_json.test(param[1],\n    /* Null */\n    5);\n  })));\n}\n\nvar definition =\n/* tuple */\n[parse, ppx_printed_query, definition_002];\n\nfunction ret_type(f) {\n  return {};\n}\n\nvar MT_Ret = {};\nvar CreateTargetVersionMutation = {\n  ppx_printed_query: ppx_printed_query,\n  query: ppx_printed_query,\n  parse: parse,\n  make: make,\n  makeWithVariables: makeWithVariables,\n  makeVariables: makeVariables,\n  definition: definition,\n  ret_type: ret_type,\n  MT_Ret: MT_Ret\n};\n\nfunction loadContentBlocks(targetId, send, version) {\n  var targetVersionId = OptionUtils.map(CurriculumEditor__Version.id, version);\n\n  Curry._1(send,\n  /* SetLoading */\n  0);\n\n  (function (eta) {\n    return GraphqlQuery.sendQuery(undefined, eta);\n  })(ContentBlock.Query.make(targetId, targetVersionId,\n  /* () */\n  0)).then(function (result) {\n    var contentBlocks = result.contentBlocks.map(ContentBlock.makeFromJs);\n    var versions = CurriculumEditor__Version.makeArrayFromJs(result.targetVersions);\n    var selectedVersion = version !== undefined ? version : Caml_array.caml_array_get(versions, 0);\n\n    Curry._1(send,\n    /* LoadContent */\n    [contentBlocks, versions, selectedVersion]);\n\n    return Promise.resolve(\n    /* () */\n    0);\n  });\n  return (\n    /* () */\n    0\n  );\n}\n\nfunction createTargetVersion(targetId, targetVersion, send) {\n  var targetVersionId = CurriculumEditor__Version.id(targetVersion);\n\n  Curry._1(send,\n  /* SetLoading */\n  0);\n\n  (function (eta) {\n    return GraphqlQuery.sendQuery(undefined, eta);\n  })(make(targetVersionId,\n  /* () */\n  0)).then(function (_result) {\n    loadContentBlocks(targetId, send, undefined);\n    return Promise.resolve(\n    /* () */\n    0);\n  });\n  return (\n    /* () */\n    0\n  );\n}\n\nfunction versionText(version) {\n  return React.createElement(\"div\", undefined, React.createElement(\"span\", {\n    className: \"font-semibold text-lg\"\n  }, \"#\" + (String(CurriculumEditor__Version.number(version)) + \" \")), React.createElement(\"span\", {\n    className: \"text-xs\"\n  }, CurriculumEditor__Version.versionAt(version)));\n}\n\nfunction showDropdown(versions, selectedVersion, loadContentBlocksCB) {\n  var contents = $$Array.map(function (version) {\n    var id = CurriculumEditor__Version.id(version);\n    return React.createElement(\"button\", {\n      key: id,\n      className: \"whitespace-no-wrap px-3 py-2 cursor-pointer hover:bg-gray-100 hover:text-primary-500 w-full text-left\",\n      id: id,\n      title: \"Select version \" + id,\n      onClick: function onClick(param) {\n        return Curry._1(loadContentBlocksCB, version);\n      }\n    }, versionText(version));\n  }, versions.filter(function (version) {\n    return Caml_obj.caml_notequal(version, selectedVersion);\n  }));\n  var selected = React.createElement(\"button\", {\n    className: \"text-sm appearance-none bg-white inline-flex items-center justify-between focus:outline-none hover:bg-gray-100 hover:shadow-lg px-3 h-full\",\n    title: \"Select version \" + CurriculumEditor__Version.id(selectedVersion)\n  }, React.createElement(\"span\", undefined, versionText(selectedVersion)), React.createElement(\"span\", {\n    className: \"border-l border-gray-400 ml-2 pl-2\"\n  }, React.createElement(\"i\", {\n    className: \"fas fa-chevron-down text-sm\"\n  })));\n\n  if (versions.length === 1) {\n    return React.createElement(\"div\", {\n      className: \"text-sm appearance-none bg-white px-3\"\n    }, React.createElement(\"span\", {\n      className: \"font-semibold text-lg\"\n    }, \"#1 \"), CurriculumEditor__Version.versionAt(selectedVersion));\n  } else {\n    return React.createElement(Dropdown.make, {\n      selected: selected,\n      contents: contents,\n      right: true,\n      className: \"h-full\"\n    });\n  }\n}\n\nfunction showContentBlocks(contentBlocks, versions, selectedVersion, loadContentBlocksCB, targetId, send) {\n  return React.createElement(\"div\", undefined, React.createElement(\"div\", undefined, React.createElement(\"label\", {\n    className: \"text-xs inline-block text-gray-600 mb-1\"\n  }, versions.length > 1 ? \"Versions\" : \"Version\"), React.createElement(HelpIcon.make, {\n    className: \"ml-1\",\n    link: \"https://docs.pupilfirst.com/#/curriculum_editor?id=target-content-versions\",\n    children: \"Use the versions feature to preserve the existing state of a target's content, to browse earlier stored versions, and to restore them, if required.\"\n  })), React.createElement(\"div\", {\n    className: \"flex\"\n  }, React.createElement(\"div\", {\n    className: \"border border-gray-400 flex items-center\"\n  }, showDropdown(versions, selectedVersion, loadContentBlocksCB)), React.createElement(\"div\", {\n    className: \"ml-2\"\n  }, React.createElement(\"button\", {\n    className: \"btn btn-primary-ghost\",\n    onClick: function onClick(param) {\n      return createTargetVersion(targetId, selectedVersion, send);\n    }\n  }, CurriculumEditor__Version.isLatestTargetVersion(versions, selectedVersion) ? \"Save this version\" : \"Restore this version\"))), React.createElement(TargetContentView.make, {\n    contentBlocks: contentBlocks\n  }));\n}\n\nfunction CurriculumEditor__VersionsEditor(Props) {\n  var targetId = Props.targetId;\n  var match = React.useReducer(reducer,\n  /* Loading */\n  0);\n  var send = match[1];\n  var state = match[0];\n\n  var loadContentBlocksCB = function loadContentBlocksCB(param) {\n    return loadContentBlocks(targetId, send, param);\n  };\n\n  React.useEffect(function () {\n    loadContentBlocks(targetId, send, undefined);\n    return;\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"max-w-3xl py-6 px-3 mx-auto\"\n  }, state ? showContentBlocks(state[0], state[2], state[1], loadContentBlocksCB, targetId, send) : SkeletonLoading.multiple(2, SkeletonLoading.contents(\n  /* () */\n  0)));\n}\n\nvar make$1 = CurriculumEditor__VersionsEditor;\nexports.str = str;\nexports.reducer = reducer;\nexports.CreateTargetVersionMutation = CreateTargetVersionMutation;\nexports.loadContentBlocks = loadContentBlocks;\nexports.createTargetVersion = createTargetVersion;\nexports.versionText = versionText;\nexports.showDropdown = showDropdown;\nexports.showContentBlocks = showContentBlocks;\nexports.make = make$1;\n/* react Not a pure module */","map":{"version":3,"sources":["/home/kochar/Documents/pupilfirst-master/app/javascript/schools/courses/components/curriculum_editor/CurriculumEditor__VersionsEditor.bs.js"],"names":["$$Array","require","Curry","React","Js_exn","Js_dict","Js_json","Caml_obj","Dropdown","HelpIcon","Js_option","Caml_array","Caml_option","OptionUtils","ContentBlock","GraphqlQuery","SkeletonLoading","TargetContentView","CurriculumEditor__Version","str","prim","reducer","_state","action","ppx_printed_query","parse","value","value$1","getExn","decodeObject","match","get","tmp","undefined","value$2","valFromOption","match$1","tmp$1","value$3","match$2","decodeBoolean","raiseError","JSON","stringify","success","createTargetVersion","make","targetVersionId","param","query","variables","fromArray","filter","test","makeWithVariables","makeVariables","definition_002","graphql_ppx_use_json_variables_fn","_1","definition","ret_type","f","MT_Ret","CreateTargetVersionMutation","loadContentBlocks","targetId","send","version","map","id","eta","sendQuery","Query","then","result","contentBlocks","makeFromJs","versions","makeArrayFromJs","targetVersions","selectedVersion","caml_array_get","Promise","resolve","targetVersion","_result","versionText","createElement","className","String","number","versionAt","showDropdown","loadContentBlocksCB","contents","key","title","onClick","caml_notequal","selected","length","right","showContentBlocks","link","children","isLatestTargetVersion","CurriculumEditor__VersionsEditor","Props","useReducer","state","useEffect","multiple","make$1","exports"],"mappings":"AAAA;AACA;;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,6BAAD,CAArB;;AACA,IAAIC,KAAK,GAAGD,OAAO,CAAC,6BAAD,CAAnB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAC,OAAD,CAAnB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,8BAAD,CAApB;;AACA,IAAII,OAAO,GAAGJ,OAAO,CAAC,+BAAD,CAArB;;AACA,IAAIK,OAAO,GAAGL,OAAO,CAAC,+BAAD,CAArB;;AACA,IAAIM,QAAQ,GAAGN,OAAO,CAAC,gCAAD,CAAtB;;AACA,IAAIO,QAAQ,GAAGP,OAAO,CAAC,8CAAD,CAAtB;;AACA,IAAIQ,QAAQ,GAAGR,OAAO,CAAC,8CAAD,CAAtB;;AACA,IAAIS,SAAS,GAAGT,OAAO,CAAC,iCAAD,CAAvB;;AACA,IAAIU,UAAU,GAAGV,OAAO,CAAC,kCAAD,CAAxB;;AACA,IAAIW,WAAW,GAAGX,OAAO,CAAC,mCAAD,CAAzB;;AACA,IAAIY,WAAW,GAAGZ,OAAO,CAAC,4CAAD,CAAzB;;AACA,IAAIa,YAAY,GAAGb,OAAO,CAAC,6CAAD,CAA1B;;AACA,IAAIc,YAAY,GAAGd,OAAO,CAAC,6CAAD,CAA1B;;AACA,IAAIe,eAAe,GAAGf,OAAO,CAAC,qDAAD,CAA7B;;AACA,IAAIgB,iBAAiB,GAAGhB,OAAO,CAAC,uDAAD,CAA/B;;AACA,IAAIiB,yBAAyB,GAAGjB,OAAO,CAAC,+DAAD,CAAvC;;AAEA,SAASkB,GAAT,CAAaC,IAAb,EAAmB;AACjB,SAAOA,IAAP;AACD;;AAED,SAASC,OAAT,CAAiBC,MAAjB,EAAyBC,MAAzB,EAAiC;AAC/B,MAAIA,MAAJ,EAAY;AACV;AAAO;AAAY,OACXA,MAAM,CAAC,CAAD,CADK,EAEXA,MAAM,CAAC,CAAD,CAFK,EAGXA,MAAM,CAAC,CAAD,CAHK;AAAnB;AAKD,GAND,MAMO;AACL;AAAO;AAAa;AAApB;AACD;AACF;;AAED,IAAIC,iBAAiB,GAAG,gJAAxB;;AAEA,SAASC,KAAT,CAAeC,KAAf,EAAsB;AACpB,MAAIC,OAAO,GAAGjB,SAAS,CAACkB,MAAV,CAAiBtB,OAAO,CAACuB,YAAR,CAAqBH,KAArB,CAAjB,CAAd;AACA,MAAII,KAAK,GAAGzB,OAAO,CAAC0B,GAAR,CAAYJ,OAAZ,EAAqB,qBAArB,CAAZ;AACA,MAAIK,GAAJ;;AACA,MAAIF,KAAK,KAAKG,SAAd,EAAyB;AACvB,QAAIC,OAAO,GAAGxB,SAAS,CAACkB,MAAV,CAAiBtB,OAAO,CAACuB,YAAR,CAAqBjB,WAAW,CAACuB,aAAZ,CAA0BL,KAA1B,CAArB,CAAjB,CAAd;AACA,QAAIM,OAAO,GAAG/B,OAAO,CAAC0B,GAAR,CAAYG,OAAZ,EAAqB,SAArB,CAAd;AACA,QAAIG,KAAJ;;AACA,QAAID,OAAO,KAAKH,SAAhB,EAA2B;AACzB,UAAIK,OAAO,GAAG1B,WAAW,CAACuB,aAAZ,CAA0BC,OAA1B,CAAd;AACA,UAAIG,OAAO,GAAGjC,OAAO,CAACkC,aAAR,CAAsBF,OAAtB,CAAd;AACAD,MAAAA,KAAK,GAAGE,OAAO,KAAKN,SAAZ,GAAwBM,OAAxB,GAAkCnC,MAAM,CAACqC,UAAP,CAAkB,wCAAwCC,IAAI,CAACC,SAAL,CAAeL,OAAf,CAA1D,CAA1C;AACD,KAJD,MAIO;AACLD,MAAAA,KAAK,GAAGjC,MAAM,CAACqC,UAAP,CAAkB,0EAAlB,CAAR;AACD;;AACDT,IAAAA,GAAG,GAAG;AACJY,MAAAA,OAAO,EAAEP;AADL,KAAN;AAGD,GAdD,MAcO;AACLL,IAAAA,GAAG,GAAG5B,MAAM,CAACqC,UAAP,CAAkB,oEAAlB,CAAN;AACD;;AACD,SAAO;AACCI,IAAAA,mBAAmB,EAAEb;AADtB,GAAP;AAGD;;AAED,SAASc,IAAT,CAAcC,eAAd,EAA+BC,KAA/B,EAAsC;AACpC,SAAO;AACCC,IAAAA,KAAK,EAAEzB,iBADR;AAEC0B,IAAAA,SAAS,EAAE7C,OAAO,CAAC8C,SAAR,CAAkB;AAAC;AAAW,KAC/B,iBAD+B,EAE/BJ,eAF+B,CAAZ,EAGlBK,MAHkB,CAGV,UAAUJ,KAAV,EAAiB;AACxB,aAAO,CAAC1C,OAAO,CAAC+C,IAAR,CAAaL,KAAK,CAAC,CAAD,CAAlB;AAAuB;AAAU,OAAjC,CAAR;AACD,KALkB,CAAlB,CAFZ;AAQCvB,IAAAA,KAAK,EAAEA;AARR,GAAP;AAUD;;AAED,SAAS6B,iBAAT,CAA2BJ,SAA3B,EAAsC;AACpC,MAAIH,eAAe,GAAGG,SAAS,CAACH,eAAhC;AACA,SAAO;AACCE,IAAAA,KAAK,EAAEzB,iBADR;AAEC0B,IAAAA,SAAS,EAAE7C,OAAO,CAAC8C,SAAR,CAAkB;AAAC;AAAW,KAC/B,iBAD+B,EAE/BJ,eAF+B,CAAZ,EAGlBK,MAHkB,CAGV,UAAUJ,KAAV,EAAiB;AACxB,aAAO,CAAC1C,OAAO,CAAC+C,IAAR,CAAaL,KAAK,CAAC,CAAD,CAAlB;AAAuB;AAAU,OAAjC,CAAR;AACD,KALkB,CAAlB,CAFZ;AAQCvB,IAAAA,KAAK,EAAEA;AARR,GAAP;AAUD;;AAED,SAAS8B,aAAT,CAAuBR,eAAvB,EAAwCC,KAAxC,EAA+C;AAC7C,SAAO3C,OAAO,CAAC8C,SAAR,CAAkB;AAAC;AAAW,GACrB,iBADqB,EAErBJ,eAFqB,CAAZ,EAGRK,MAHQ,CAGA,UAAUJ,KAAV,EAAiB;AACxB,WAAO,CAAC1C,OAAO,CAAC+C,IAAR,CAAaL,KAAK,CAAC,CAAD,CAAlB;AAAuB;AAAU,KAAjC,CAAR;AACD,GALQ,CAAlB,CAAP;AAMD;;AAED,SAASQ,cAAT,CAAwBC,iCAAxB,EAA2DV,eAA3D,EAA4EC,KAA5E,EAAmF;AACjF,SAAO9C,KAAK,CAACwD,EAAN,CAASD,iCAAT,EAA4CpD,OAAO,CAAC8C,SAAR,CAAkB;AAAC;AAAW,GAC7D,iBAD6D,EAE7DJ,eAF6D,CAAZ,EAGhDK,MAHgD,CAGxC,UAAUJ,KAAV,EAAiB;AACxB,WAAO,CAAC1C,OAAO,CAAC+C,IAAR,CAAaL,KAAK,CAAC,CAAD,CAAlB;AAAuB;AAAU,KAAjC,CAAR;AACD,GALgD,CAAlB,CAA5C,CAAP;AAMD;;AAED,IAAIW,UAAU;AAAG;AAAW,CAC1BlC,KAD0B,EAE1BD,iBAF0B,EAG1BgC,cAH0B,CAA5B;;AAMA,SAASI,QAAT,CAAkBC,CAAlB,EAAqB;AACnB,SAAO,EAAP;AACD;;AAED,IAAIC,MAAM,GAAG,EAAb;AAEA,IAAIC,2BAA2B,GAAG;AAChCvC,EAAAA,iBAAiB,EAAEA,iBADa;AAEhCyB,EAAAA,KAAK,EAAEzB,iBAFyB;AAGhCC,EAAAA,KAAK,EAAEA,KAHyB;AAIhCqB,EAAAA,IAAI,EAAEA,IAJ0B;AAKhCQ,EAAAA,iBAAiB,EAAEA,iBALa;AAMhCC,EAAAA,aAAa,EAAEA,aANiB;AAOhCI,EAAAA,UAAU,EAAEA,UAPoB;AAQhCC,EAAAA,QAAQ,EAAEA,QARsB;AAShCE,EAAAA,MAAM,EAAEA;AATwB,CAAlC;;AAYA,SAASE,iBAAT,CAA2BC,QAA3B,EAAqCC,IAArC,EAA2CC,OAA3C,EAAoD;AAClD,MAAIpB,eAAe,GAAGlC,WAAW,CAACuD,GAAZ,CAAgBlD,yBAAyB,CAACmD,EAA1C,EAA8CF,OAA9C,CAAtB;;AACAjE,EAAAA,KAAK,CAACwD,EAAN,CAASQ,IAAT;AAAe;AAAgB,GAA/B;;AACA,GAAC,UAAUI,GAAV,EAAe;AACR,WAAOvD,YAAY,CAACwD,SAAb,CAAuBtC,SAAvB,EAAkCqC,GAAlC,CAAP;AACD,GAFP,EAESxD,YAAY,CAAC0D,KAAb,CAAmB1B,IAAnB,CAAwBmB,QAAxB,EAAkClB,eAAlC;AAAmD;AAAQ,GAA3D,CAFT,EAEwE0B,IAFxE,CAE8E,UAAUC,MAAV,EAAkB;AACxF,QAAIC,aAAa,GAAGD,MAAM,CAACC,aAAP,CAAqBP,GAArB,CAAyBtD,YAAY,CAAC8D,UAAtC,CAApB;AACA,QAAIC,QAAQ,GAAG3D,yBAAyB,CAAC4D,eAA1B,CAA0CJ,MAAM,CAACK,cAAjD,CAAf;AACA,QAAIC,eAAe,GAAGb,OAAO,KAAKlC,SAAZ,GAAwBkC,OAAxB,GAAkCxD,UAAU,CAACsE,cAAX,CAA0BJ,QAA1B,EAAoC,CAApC,CAAxD;;AACA3E,IAAAA,KAAK,CAACwD,EAAN,CAASQ,IAAT;AAAe;AAAiB,KAC1BS,aAD0B,EAE1BE,QAF0B,EAG1BG,eAH0B,CAAhC;;AAKA,WAAOE,OAAO,CAACC,OAAR;AAAgB;AAAQ,KAAxB,CAAP;AACD,GAZP;AAaA;AAAO;AAAQ;AAAf;AACD;;AAED,SAAStC,mBAAT,CAA6BoB,QAA7B,EAAuCmB,aAAvC,EAAsDlB,IAAtD,EAA4D;AAC1D,MAAInB,eAAe,GAAG7B,yBAAyB,CAACmD,EAA1B,CAA6Be,aAA7B,CAAtB;;AACAlF,EAAAA,KAAK,CAACwD,EAAN,CAASQ,IAAT;AAAe;AAAgB,GAA/B;;AACA,GAAC,UAAUI,GAAV,EAAe;AACR,WAAOvD,YAAY,CAACwD,SAAb,CAAuBtC,SAAvB,EAAkCqC,GAAlC,CAAP;AACD,GAFP,EAESxB,IAAI,CAACC,eAAD;AAAkB;AAAQ,GAA1B,CAFb,EAE2C0B,IAF3C,CAEiD,UAAUY,OAAV,EAAmB;AAC5DrB,IAAAA,iBAAiB,CAACC,QAAD,EAAWC,IAAX,EAAiBjC,SAAjB,CAAjB;AACA,WAAOiD,OAAO,CAACC,OAAR;AAAgB;AAAQ,KAAxB,CAAP;AACD,GALP;AAMA;AAAO;AAAQ;AAAf;AACD;;AAED,SAASG,WAAT,CAAqBnB,OAArB,EAA8B;AAC5B,SAAOhE,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2BtD,SAA3B,EAAsC9B,KAAK,CAACoF,aAAN,CAAoB,MAApB,EAA4B;AACzDC,IAAAA,SAAS,EAAE;AAD8C,GAA5B,EAE5B,OAAOC,MAAM,CAACvE,yBAAyB,CAACwE,MAA1B,CAAiCvB,OAAjC,CAAD,CAAN,GAAoD,GAA3D,CAF4B,CAAtC,EAE4EhE,KAAK,CAACoF,aAAN,CAAoB,MAApB,EAA4B;AAC/FC,IAAAA,SAAS,EAAE;AADoF,GAA5B,EAElEtE,yBAAyB,CAACyE,SAA1B,CAAoCxB,OAApC,CAFkE,CAF5E,CAAP;AAKD;;AAED,SAASyB,YAAT,CAAsBf,QAAtB,EAAgCG,eAAhC,EAAiDa,mBAAjD,EAAsE;AACpE,MAAIC,QAAQ,GAAG9F,OAAO,CAACoE,GAAR,CAAa,UAAUD,OAAV,EAAmB;AACvC,QAAIE,EAAE,GAAGnD,yBAAyB,CAACmD,EAA1B,CAA6BF,OAA7B,CAAT;AACA,WAAOhE,KAAK,CAACoF,aAAN,CAAoB,QAApB,EAA8B;AACzBQ,MAAAA,GAAG,EAAE1B,EADoB;AAEzBmB,MAAAA,SAAS,EAAE,uGAFc;AAGzBnB,MAAAA,EAAE,EAAEA,EAHqB;AAIzB2B,MAAAA,KAAK,EAAE,oBAAoB3B,EAJF;AAKzB4B,MAAAA,OAAO,EAAG,iBAAUjD,KAAV,EAAiB;AACvB,eAAO9C,KAAK,CAACwD,EAAN,CAASmC,mBAAT,EAA8B1B,OAA9B,CAAP;AACD;AAPsB,KAA9B,EAQMmB,WAAW,CAACnB,OAAD,CARjB,CAAP;AASD,GAXQ,EAWLU,QAAQ,CAACzB,MAAT,CAAiB,UAAUe,OAAV,EAAmB;AAClC,WAAO5D,QAAQ,CAAC2F,aAAT,CAAuB/B,OAAvB,EAAgCa,eAAhC,CAAP;AACD,GAFD,CAXK,CAAf;AAcA,MAAImB,QAAQ,GAAGhG,KAAK,CAACoF,aAAN,CAAoB,QAApB,EAA8B;AACvCC,IAAAA,SAAS,EAAE,4IAD4B;AAEvCQ,IAAAA,KAAK,EAAE,oBAAoB9E,yBAAyB,CAACmD,EAA1B,CAA6BW,eAA7B;AAFY,GAA9B,EAGR7E,KAAK,CAACoF,aAAN,CAAoB,MAApB,EAA4BtD,SAA5B,EAAuCqD,WAAW,CAACN,eAAD,CAAlD,CAHQ,EAG8D7E,KAAK,CAACoF,aAAN,CAAoB,MAApB,EAA4B;AAC/FC,IAAAA,SAAS,EAAE;AADoF,GAA5B,EAElErF,KAAK,CAACoF,aAAN,CAAoB,GAApB,EAAyB;AACtBC,IAAAA,SAAS,EAAE;AADW,GAAzB,CAFkE,CAH9D,CAAf;;AAQA,MAAIX,QAAQ,CAACuB,MAAT,KAAoB,CAAxB,EAA2B;AACzB,WAAOjG,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2B;AACtBC,MAAAA,SAAS,EAAE;AADW,KAA3B,EAEMrF,KAAK,CAACoF,aAAN,CAAoB,MAApB,EAA4B;AACzBC,MAAAA,SAAS,EAAE;AADc,KAA5B,EAEI,KAFJ,CAFN,EAIkBtE,yBAAyB,CAACyE,SAA1B,CAAoCX,eAApC,CAJlB,CAAP;AAKD,GAND,MAMO;AACL,WAAO7E,KAAK,CAACoF,aAAN,CAAoB/E,QAAQ,CAACsC,IAA7B,EAAmC;AAC9BqD,MAAAA,QAAQ,EAAEA,QADoB;AAE9BL,MAAAA,QAAQ,EAAEA,QAFoB;AAG9BO,MAAAA,KAAK,EAAE,IAHuB;AAI9Bb,MAAAA,SAAS,EAAE;AAJmB,KAAnC,CAAP;AAMD;AACF;;AAED,SAASc,iBAAT,CAA2B3B,aAA3B,EAA0CE,QAA1C,EAAoDG,eAApD,EAAqEa,mBAArE,EAA0F5B,QAA1F,EAAoGC,IAApG,EAA0G;AACxG,SAAO/D,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2BtD,SAA3B,EAAsC9B,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2BtD,SAA3B,EAAsC9B,KAAK,CAACoF,aAAN,CAAoB,OAApB,EAA6B;AAC5FC,IAAAA,SAAS,EAAE;AADiF,GAA7B,EAE9DX,QAAQ,CAACuB,MAAT,GAAkB,CAAlB,GAAsB,UAAtB,GAAmC,SAF2B,CAAtC,EAEuBjG,KAAK,CAACoF,aAAN,CAAoB9E,QAAQ,CAACqC,IAA7B,EAAmC;AACnF0C,IAAAA,SAAS,EAAE,MADwE;AAEnFe,IAAAA,IAAI,EAAE,4EAF6E;AAGnFC,IAAAA,QAAQ,EAAE;AAHyE,GAAnC,CAFvB,CAAtC,EAMgBrG,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2B;AAClCC,IAAAA,SAAS,EAAE;AADuB,GAA3B,EAENrF,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2B;AACxBC,IAAAA,SAAS,EAAE;AADa,GAA3B,EAEII,YAAY,CAACf,QAAD,EAAWG,eAAX,EAA4Ba,mBAA5B,CAFhB,CAFM,EAI6D1F,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2B;AAC3FC,IAAAA,SAAS,EAAE;AADgF,GAA3B,EAE/DrF,KAAK,CAACoF,aAAN,CAAoB,QAApB,EAA8B;AAC3BC,IAAAA,SAAS,EAAE,uBADgB;AAE3BS,IAAAA,OAAO,EAAG,iBAAUjD,KAAV,EAAiB;AACvB,aAAOH,mBAAmB,CAACoB,QAAD,EAAWe,eAAX,EAA4Bd,IAA5B,CAA1B;AACD;AAJwB,GAA9B,EAKIhD,yBAAyB,CAACuF,qBAA1B,CAAgD5B,QAAhD,EAA0DG,eAA1D,IAA6E,mBAA7E,GAAmG,sBALvG,CAF+D,CAJ7D,CANhB,EAiBgJ7E,KAAK,CAACoF,aAAN,CAAoBtE,iBAAiB,CAAC6B,IAAtC,EAA4C;AACnL6B,IAAAA,aAAa,EAAEA;AADoK,GAA5C,CAjBhJ,CAAP;AAoBD;;AAED,SAAS+B,gCAAT,CAA0CC,KAA1C,EAAiD;AAC/C,MAAI1C,QAAQ,GAAG0C,KAAK,CAAC1C,QAArB;AACA,MAAInC,KAAK,GAAG3B,KAAK,CAACyG,UAAN,CAAiBvF,OAAjB;AAA0B;AAAa,GAAvC,CAAZ;AACA,MAAI6C,IAAI,GAAGpC,KAAK,CAAC,CAAD,CAAhB;AACA,MAAI+E,KAAK,GAAG/E,KAAK,CAAC,CAAD,CAAjB;;AACA,MAAI+D,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAU7C,KAAV,EAAiB;AACzC,WAAOgB,iBAAiB,CAACC,QAAD,EAAWC,IAAX,EAAiBlB,KAAjB,CAAxB;AACD,GAFD;;AAGA7C,EAAAA,KAAK,CAAC2G,SAAN,CAAiB,YAAY;AACrB9C,IAAAA,iBAAiB,CAACC,QAAD,EAAWC,IAAX,EAAiBjC,SAAjB,CAAjB;AACA;AACD,GAHP,EAGW,EAHX;AAIA,SAAO9B,KAAK,CAACoF,aAAN,CAAoB,KAApB,EAA2B;AACtBC,IAAAA,SAAS,EAAE;AADW,GAA3B,EAEMqB,KAAK,GAAGP,iBAAiB,CAACO,KAAK,CAAC,CAAD,CAAN,EAAWA,KAAK,CAAC,CAAD,CAAhB,EAAqBA,KAAK,CAAC,CAAD,CAA1B,EAA+BhB,mBAA/B,EAAoD5B,QAApD,EAA8DC,IAA9D,CAApB,GAA0FlD,eAAe,CAAC+F,QAAhB,CAAyB,CAAzB,EAA4B/F,eAAe,CAAC8E,QAAhB;AAAyB;AAAQ,GAAjC,CAA5B,CAFrG,CAAP;AAGD;;AAED,IAAIkB,MAAM,GAAGN,gCAAb;AAEAO,OAAO,CAAC9F,GAAR,GAAcA,GAAd;AACA8F,OAAO,CAAC5F,OAAR,GAAkBA,OAAlB;AACA4F,OAAO,CAAClD,2BAAR,GAAsCA,2BAAtC;AACAkD,OAAO,CAACjD,iBAAR,GAA4BA,iBAA5B;AACAiD,OAAO,CAACpE,mBAAR,GAA8BA,mBAA9B;AACAoE,OAAO,CAAC3B,WAAR,GAAsBA,WAAtB;AACA2B,OAAO,CAACrB,YAAR,GAAuBA,YAAvB;AACAqB,OAAO,CAACX,iBAAR,GAA4BA,iBAA5B;AACAW,OAAO,CAACnE,IAAR,GAAekE,MAAf;AACA","sourcesContent":["// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE\n'use strict';\n\nvar $$Array = require(\"bs-platform/lib/js/array.js\");\nvar Curry = require(\"bs-platform/lib/js/curry.js\");\nvar React = require(\"react\");\nvar Js_exn = require(\"bs-platform/lib/js/js_exn.js\");\nvar Js_dict = require(\"bs-platform/lib/js/js_dict.js\");\nvar Js_json = require(\"bs-platform/lib/js/js_json.js\");\nvar Caml_obj = require(\"bs-platform/lib/js/caml_obj.js\");\nvar Dropdown = require(\"../../../../shared/components/Dropdown.bs.js\");\nvar HelpIcon = require(\"../../../../shared/components/HelpIcon.bs.js\");\nvar Js_option = require(\"bs-platform/lib/js/js_option.js\");\nvar Caml_array = require(\"bs-platform/lib/js/caml_array.js\");\nvar Caml_option = require(\"bs-platform/lib/js/caml_option.js\");\nvar OptionUtils = require(\"../../../../shared/utils/OptionUtils.bs.js\");\nvar ContentBlock = require(\"../../../../shared/types/ContentBlock.bs.js\");\nvar GraphqlQuery = require(\"../../../../shared/utils/GraphqlQuery.bs.js\");\nvar SkeletonLoading = require(\"../../../../shared/components/SkeletonLoading.bs.js\");\nvar TargetContentView = require(\"../../../../shared/components/TargetContentView.bs.js\");\nvar CurriculumEditor__Version = require(\"../../types/curriculum_editor/CurriculumEditor__Version.bs.js\");\n\nfunction str(prim) {\n  return prim;\n}\n\nfunction reducer(_state, action) {\n  if (action) {\n    return /* Loaded */[\n            action[0],\n            action[2],\n            action[1]\n          ];\n  } else {\n    return /* Loading */0;\n  }\n}\n\nvar ppx_printed_query = \"mutation CreateTargetVersionMutation($targetVersionId: ID!)  {\\ncreateTargetVersion(targetVersionId: $targetVersionId)  {\\nsuccess  \\n}\\n\\n}\\n\";\n\nfunction parse(value) {\n  var value$1 = Js_option.getExn(Js_json.decodeObject(value));\n  var match = Js_dict.get(value$1, \"createTargetVersion\");\n  var tmp;\n  if (match !== undefined) {\n    var value$2 = Js_option.getExn(Js_json.decodeObject(Caml_option.valFromOption(match)));\n    var match$1 = Js_dict.get(value$2, \"success\");\n    var tmp$1;\n    if (match$1 !== undefined) {\n      var value$3 = Caml_option.valFromOption(match$1);\n      var match$2 = Js_json.decodeBoolean(value$3);\n      tmp$1 = match$2 !== undefined ? match$2 : Js_exn.raiseError(\"graphql_ppx: Expected boolean, got \" + JSON.stringify(value$3));\n    } else {\n      tmp$1 = Js_exn.raiseError(\"graphql_ppx: Field success on type CreateTargetVersionPayload is missing\");\n    }\n    tmp = {\n      success: tmp$1\n    };\n  } else {\n    tmp = Js_exn.raiseError(\"graphql_ppx: Field createTargetVersion on type Mutation is missing\");\n  }\n  return {\n          createTargetVersion: tmp\n        };\n}\n\nfunction make(targetVersionId, param) {\n  return {\n          query: ppx_printed_query,\n          variables: Js_dict.fromArray([/* tuple */[\n                    \"targetVersionId\",\n                    targetVersionId\n                  ]].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse\n        };\n}\n\nfunction makeWithVariables(variables) {\n  var targetVersionId = variables.targetVersionId;\n  return {\n          query: ppx_printed_query,\n          variables: Js_dict.fromArray([/* tuple */[\n                    \"targetVersionId\",\n                    targetVersionId\n                  ]].filter((function (param) {\n                      return !Js_json.test(param[1], /* Null */5);\n                    }))),\n          parse: parse\n        };\n}\n\nfunction makeVariables(targetVersionId, param) {\n  return Js_dict.fromArray([/* tuple */[\n                  \"targetVersionId\",\n                  targetVersionId\n                ]].filter((function (param) {\n                    return !Js_json.test(param[1], /* Null */5);\n                  })));\n}\n\nfunction definition_002(graphql_ppx_use_json_variables_fn, targetVersionId, param) {\n  return Curry._1(graphql_ppx_use_json_variables_fn, Js_dict.fromArray([/* tuple */[\n                      \"targetVersionId\",\n                      targetVersionId\n                    ]].filter((function (param) {\n                        return !Js_json.test(param[1], /* Null */5);\n                      }))));\n}\n\nvar definition = /* tuple */[\n  parse,\n  ppx_printed_query,\n  definition_002\n];\n\nfunction ret_type(f) {\n  return { };\n}\n\nvar MT_Ret = { };\n\nvar CreateTargetVersionMutation = {\n  ppx_printed_query: ppx_printed_query,\n  query: ppx_printed_query,\n  parse: parse,\n  make: make,\n  makeWithVariables: makeWithVariables,\n  makeVariables: makeVariables,\n  definition: definition,\n  ret_type: ret_type,\n  MT_Ret: MT_Ret\n};\n\nfunction loadContentBlocks(targetId, send, version) {\n  var targetVersionId = OptionUtils.map(CurriculumEditor__Version.id, version);\n  Curry._1(send, /* SetLoading */0);\n  (function (eta) {\n          return GraphqlQuery.sendQuery(undefined, eta);\n        })(ContentBlock.Query.make(targetId, targetVersionId, /* () */0)).then((function (result) {\n          var contentBlocks = result.contentBlocks.map(ContentBlock.makeFromJs);\n          var versions = CurriculumEditor__Version.makeArrayFromJs(result.targetVersions);\n          var selectedVersion = version !== undefined ? version : Caml_array.caml_array_get(versions, 0);\n          Curry._1(send, /* LoadContent */[\n                contentBlocks,\n                versions,\n                selectedVersion\n              ]);\n          return Promise.resolve(/* () */0);\n        }));\n  return /* () */0;\n}\n\nfunction createTargetVersion(targetId, targetVersion, send) {\n  var targetVersionId = CurriculumEditor__Version.id(targetVersion);\n  Curry._1(send, /* SetLoading */0);\n  (function (eta) {\n          return GraphqlQuery.sendQuery(undefined, eta);\n        })(make(targetVersionId, /* () */0)).then((function (_result) {\n          loadContentBlocks(targetId, send, undefined);\n          return Promise.resolve(/* () */0);\n        }));\n  return /* () */0;\n}\n\nfunction versionText(version) {\n  return React.createElement(\"div\", undefined, React.createElement(\"span\", {\n                  className: \"font-semibold text-lg\"\n                }, \"#\" + (String(CurriculumEditor__Version.number(version)) + \" \")), React.createElement(\"span\", {\n                  className: \"text-xs\"\n                }, CurriculumEditor__Version.versionAt(version)));\n}\n\nfunction showDropdown(versions, selectedVersion, loadContentBlocksCB) {\n  var contents = $$Array.map((function (version) {\n          var id = CurriculumEditor__Version.id(version);\n          return React.createElement(\"button\", {\n                      key: id,\n                      className: \"whitespace-no-wrap px-3 py-2 cursor-pointer hover:bg-gray-100 hover:text-primary-500 w-full text-left\",\n                      id: id,\n                      title: \"Select version \" + id,\n                      onClick: (function (param) {\n                          return Curry._1(loadContentBlocksCB, version);\n                        })\n                    }, versionText(version));\n        }), versions.filter((function (version) {\n              return Caml_obj.caml_notequal(version, selectedVersion);\n            })));\n  var selected = React.createElement(\"button\", {\n        className: \"text-sm appearance-none bg-white inline-flex items-center justify-between focus:outline-none hover:bg-gray-100 hover:shadow-lg px-3 h-full\",\n        title: \"Select version \" + CurriculumEditor__Version.id(selectedVersion)\n      }, React.createElement(\"span\", undefined, versionText(selectedVersion)), React.createElement(\"span\", {\n            className: \"border-l border-gray-400 ml-2 pl-2\"\n          }, React.createElement(\"i\", {\n                className: \"fas fa-chevron-down text-sm\"\n              })));\n  if (versions.length === 1) {\n    return React.createElement(\"div\", {\n                className: \"text-sm appearance-none bg-white px-3\"\n              }, React.createElement(\"span\", {\n                    className: \"font-semibold text-lg\"\n                  }, \"#1 \"), CurriculumEditor__Version.versionAt(selectedVersion));\n  } else {\n    return React.createElement(Dropdown.make, {\n                selected: selected,\n                contents: contents,\n                right: true,\n                className: \"h-full\"\n              });\n  }\n}\n\nfunction showContentBlocks(contentBlocks, versions, selectedVersion, loadContentBlocksCB, targetId, send) {\n  return React.createElement(\"div\", undefined, React.createElement(\"div\", undefined, React.createElement(\"label\", {\n                      className: \"text-xs inline-block text-gray-600 mb-1\"\n                    }, versions.length > 1 ? \"Versions\" : \"Version\"), React.createElement(HelpIcon.make, {\n                      className: \"ml-1\",\n                      link: \"https://docs.pupilfirst.com/#/curriculum_editor?id=target-content-versions\",\n                      children: \"Use the versions feature to preserve the existing state of a target's content, to browse earlier stored versions, and to restore them, if required.\"\n                    })), React.createElement(\"div\", {\n                  className: \"flex\"\n                }, React.createElement(\"div\", {\n                      className: \"border border-gray-400 flex items-center\"\n                    }, showDropdown(versions, selectedVersion, loadContentBlocksCB)), React.createElement(\"div\", {\n                      className: \"ml-2\"\n                    }, React.createElement(\"button\", {\n                          className: \"btn btn-primary-ghost\",\n                          onClick: (function (param) {\n                              return createTargetVersion(targetId, selectedVersion, send);\n                            })\n                        }, CurriculumEditor__Version.isLatestTargetVersion(versions, selectedVersion) ? \"Save this version\" : \"Restore this version\"))), React.createElement(TargetContentView.make, {\n                  contentBlocks: contentBlocks\n                }));\n}\n\nfunction CurriculumEditor__VersionsEditor(Props) {\n  var targetId = Props.targetId;\n  var match = React.useReducer(reducer, /* Loading */0);\n  var send = match[1];\n  var state = match[0];\n  var loadContentBlocksCB = function (param) {\n    return loadContentBlocks(targetId, send, param);\n  };\n  React.useEffect((function () {\n          loadContentBlocks(targetId, send, undefined);\n          return ;\n        }), ([]));\n  return React.createElement(\"div\", {\n              className: \"max-w-3xl py-6 px-3 mx-auto\"\n            }, state ? showContentBlocks(state[0], state[2], state[1], loadContentBlocksCB, targetId, send) : SkeletonLoading.multiple(2, SkeletonLoading.contents(/* () */0)));\n}\n\nvar make$1 = CurriculumEditor__VersionsEditor;\n\nexports.str = str;\nexports.reducer = reducer;\nexports.CreateTargetVersionMutation = CreateTargetVersionMutation;\nexports.loadContentBlocks = loadContentBlocks;\nexports.createTargetVersion = createTargetVersion;\nexports.versionText = versionText;\nexports.showDropdown = showDropdown;\nexports.showContentBlocks = showContentBlocks;\nexports.make = make$1;\n/* react Not a pure module */\n"]},"metadata":{},"sourceType":"module"}